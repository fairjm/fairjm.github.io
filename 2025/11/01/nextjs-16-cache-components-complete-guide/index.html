<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Next.js 16 Cache Components å®Œå…¨æŒ‡å— | å°éº¦çš„æ‚è´§é“º</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="åŸºäº Next.js 16.0.1 å®˜æ–¹æ–‡æ¡£æ•´ç†  ç›®å½• ä»€ä¹ˆæ˜¯ Cache Components æ ¸å¿ƒå·¥ä½œåŸç† ä½¿ç”¨ Suspense è¾¹ç•Œ ä½¿ç”¨ use cache å¯ç”¨ Cache Components ä»æ—§ç‰ˆæœ¬è¿ç§» å®æˆ˜ç¤ºä¾‹ æœ€ä½³å®è·µ å’Œ Next-intl ç»“åˆ å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ FAQ å‚è€ƒèµ„æ–™   è¿™è¾¹æ–‡æ¡£ä¸»è¦æ˜¯ AI æ€»ç»“+æˆ‘è¡¥å……å®é™…é‡åˆ°çš„é—®é¢˜ï¼Œå¤§éƒ¨åˆ†æ˜¯ AI å†™çš„ã€‚ æ³¨æ„ï¼Œæ–‡">
<meta property="og:type" content="article">
<meta property="og:title" content="Next.js 16 Cache Components å®Œå…¨æŒ‡å—">
<meta property="og:url" content="https://bingowith.me/2025/11/01/nextjs-16-cache-components-complete-guide/index.html">
<meta property="og:site_name" content="å°éº¦çš„æ‚è´§é“º">
<meta property="og:description" content="åŸºäº Next.js 16.0.1 å®˜æ–¹æ–‡æ¡£æ•´ç†  ç›®å½• ä»€ä¹ˆæ˜¯ Cache Components æ ¸å¿ƒå·¥ä½œåŸç† ä½¿ç”¨ Suspense è¾¹ç•Œ ä½¿ç”¨ use cache å¯ç”¨ Cache Components ä»æ—§ç‰ˆæœ¬è¿ç§» å®æˆ˜ç¤ºä¾‹ æœ€ä½³å®è·µ å’Œ Next-intl ç»“åˆ å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ FAQ å‚è€ƒèµ„æ–™   è¿™è¾¹æ–‡æ¡£ä¸»è¦æ˜¯ AI æ€»ç»“+æˆ‘è¡¥å……å®é™…é‡åˆ°çš„é—®é¢˜ï¼Œå¤§éƒ¨åˆ†æ˜¯ AI å†™çš„ã€‚ æ³¨æ„ï¼Œæ–‡">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://h8dxkfmaphn8o0p3.public.blob.vercel-storage.com/learn/light/thinking-in-ppr.png">
<meta property="og:image" content="https://h8dxkfmaphn8o0p3.public.blob.vercel-storage.com/docs/light/server-rendering-with-streaming.png">
<meta property="og:image" content="https://h8dxkfmaphn8o0p3.public.blob.vercel-storage.com/docs/light/sequential-parallel-data-fetching.png">
<meta property="article:published_time" content="2025-11-01T08:58:02.000Z">
<meta property="article:modified_time" content="2025-11-01T08:58:02.000Z">
<meta property="article:author" content="abaabaqua">
<meta property="article:tag" content="Next.js">
<meta property="article:tag" content="Cache Components">
<meta property="article:tag" content="React">
<meta property="article:tag" content="Next.js 16">
<meta property="article:tag" content="Web Development">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://h8dxkfmaphn8o0p3.public.blob.vercel-storage.com/learn/light/thinking-in-ppr.png">
  
    <link rel="alternate" href="/atom.xml" title="å°éº¦çš„æ‚è´§é“º" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css">

  
<!-- hexo injector head_end start -->
    <link rel="stylesheet" href="/css/cc_custom.css">
  <!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">å°éº¦çš„æ‚è´§é“º</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">æ—¥å¸¸éšç¬”~</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          
            <a class="nav-icon" target="_blank" rel="noopener" href="https://github.com/fairjm"><span class="fa fa-github"></span></a>
          
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS è®¢é˜…"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="æœç´¢"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="æœç´¢"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://bingowith.me"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-nextjs-16-cache-components-complete-guide" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/11/01/nextjs-16-cache-components-complete-guide/" class="article-date">
  <time class="dt-published" datetime="2025-11-01T08:58:02.000Z" itemprop="datePublished">2025-11-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Next.js 16 Cache Components å®Œå…¨æŒ‡å—
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>åŸºäº Next.js 16.0.1 å®˜æ–¹æ–‡æ¡£æ•´ç†</p>
</blockquote>
<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ol>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF-cache-components">ä»€ä¹ˆæ˜¯ Cache Components</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">æ ¸å¿ƒå·¥ä½œåŸç†</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8-suspense-%E8%BE%B9%E7%95%8C">ä½¿ç”¨ Suspense è¾¹ç•Œ</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8-use-cache">ä½¿ç”¨ use cache</a></li>
<li><a href="#%E5%90%AF%E7%94%A8-cache-components">å¯ç”¨ Cache Components</a></li>
<li><a href="#%E4%BB%8E%E6%97%A7%E7%89%88%E6%9C%AC%E8%BF%81%E7%A7%BB">ä»æ—§ç‰ˆæœ¬è¿ç§»</a></li>
<li><a href="#%E5%AE%9E%E6%88%98%E7%A4%BA%E4%BE%8B">å®æˆ˜ç¤ºä¾‹</a></li>
<li><a href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">æœ€ä½³å®è·µ</a></li>
<li><a href="#%E5%92%8C-Next-intl-%E7%BB%93%E5%90%88">å’Œ Next-intl ç»“åˆ</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="#faq">FAQ</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li>
</ol>
<hr>
<p>è¿™è¾¹æ–‡æ¡£ä¸»è¦æ˜¯ AI æ€»ç»“+æˆ‘è¡¥å……å®é™…é‡åˆ°çš„é—®é¢˜ï¼Œå¤§éƒ¨åˆ†æ˜¯ AI å†™çš„ã€‚</p>
<p>æ³¨æ„ï¼Œæ–‡æ¡£é‡Œä¸åŒ…å«<code>use cache: private</code>çš„å†…å®¹ï¼Œåœ¨å†™çš„æ—¶å€™æœ¬æ¥å®˜æ–¹æ–‡æ¡£é‡Œè¯´ä¾èµ–<code>unstable_prefetch</code>ï¼Œä½†æ˜¯åæ¥ä¸€çœ‹è¿™ä¸ªå†…å®¹åˆè¢«ç§»é™¤äº†ï¼Œä¸çŸ¥é“åç»­ä¼šä¸ä¼šå†æ”¹ï¼Œå…ˆä¸å†™äº†ï¼Œä»¥å®˜æ–¹æ–‡æ¡£ä¸ºå‡†ã€‚<a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/directives/use-cache-private">API Reference &gt; Directives &gt; use cache: private</a></p>
<p>æ³¨æ„ï¼Œç°åœ¨çš„ 16.0 è¿˜åœ¨ä¸æ–­å˜åŒ–ä¸­ï¼Œè¿˜æ˜¯ç­‰ 16.1ï¼Œ16.2 å†ç”¨å§ã€‚è¿™ä¸œè¥¿å¤ªä¸ç¨³äº†ã€‚</p>
<p><code>Cache components</code>é™¤äº†æ–¹ä¾¿çš„ PPR+æ˜¾å¼ç¼“å­˜ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯åœ¨æ¡†æ¶å±‚é¢ï¼ˆä¸»è¦æ˜¯ dev å’Œæ„å»ºçš„æ—¶å€™ï¼‰ï¼Œé˜²æ­¢ç”¨æˆ·å†™å‡ºåŠ¨æ€å†…å®¹å¡ä½æ•´ä¸ªé¡µé¢åŠ è½½çš„äº‹ï¼Œè¿™åœ¨ä¹‹å‰å¾ˆå®¹æ˜“å†™å‡ºæ¥ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šæ‰¹è¯„çš„æ–‡ç« å’Œè§†é¢‘ï¼Œä¸€çœ‹è¿<code>loading.tsx</code>å’Œ<code>Suspense</code>éƒ½ä¸ä¼šç”¨ã€‚ğŸ˜‚<br>ç°åœ¨å®˜æ–¹å¼ºåˆ¶äº†ï¼Œä¹Ÿæ˜¯ä»¶å¥½äº‹å§ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯-Cache-Components"><a href="#ä»€ä¹ˆæ˜¯-Cache-Components" class="headerlink" title="ä»€ä¹ˆæ˜¯ Cache Components"></a>ä»€ä¹ˆæ˜¯ Cache Components</h2><p><strong>Cache Components</strong> æ˜¯ Next.js 16 ä¸­ä¸€ç§æ–°çš„æ¸²æŸ“å’Œç¼“å­˜æ–¹æ³•ï¼Œé€šè¿‡ <strong>Partial Prerendering (PPR)</strong> æä¾›ç»†ç²’åº¦çš„ç¼“å­˜æ§åˆ¶ï¼ŒåŒæ—¶ç¡®ä¿å‡ºè‰²çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<h3 id="æ ¸å¿ƒå…³ç³»"><a href="#æ ¸å¿ƒå…³ç³»" class="headerlink" title="æ ¸å¿ƒå…³ç³»"></a>æ ¸å¿ƒå…³ç³»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cache Components = PPR + use cache</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>PPR</strong> æä¾›é™æ€å¤–å£³å’Œæµå¼ä¼ è¾“åŸºç¡€è®¾æ–½</li>
<li><strong><code>use cache</code></strong> è®©ä½ åœ¨å¤–å£³ä¸­åŒ…å«ä¼˜åŒ–çš„åŠ¨æ€è¾“å‡º</li>
</ul>
<h3 id="è§£å†³çš„é—®é¢˜"><a href="#è§£å†³çš„é—®é¢˜" class="headerlink" title="è§£å†³çš„é—®é¢˜"></a>è§£å†³çš„é—®é¢˜</h3><p>åœ¨å¼€å‘åŠ¨æ€åº”ç”¨æ—¶ï¼Œä½ éœ€è¦åœ¨ä¸¤ç§æ–¹å¼ä¹‹é—´æƒè¡¡ï¼š</p>
<ul>
<li>âŒ <strong>å®Œå…¨é™æ€é¡µé¢</strong>ï¼šåŠ è½½å¿«ï¼Œä½†æ— æ³•æ˜¾ç¤ºä¸ªæ€§åŒ–æˆ–å®æ—¶æ•°æ®</li>
<li>âŒ <strong>å®Œå…¨åŠ¨æ€é¡µé¢</strong>ï¼šå¯æ˜¾ç¤ºæœ€æ–°æ•°æ®ï¼Œä½†æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦æ¸²æŸ“æ‰€æœ‰å†…å®¹ï¼Œå¯¼è‡´åˆå§‹åŠ è½½æ…¢</li>
</ul>
<span id="more"></span>

<p>âœ… <strong>Cache Components çš„è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<p>å¯ç”¨ Cache Components åï¼ŒNext.js å°†æ‰€æœ‰è·¯ç”±<strong>é»˜è®¤è§†ä¸ºåŠ¨æ€</strong>ã€‚æ¯ä¸ªè¯·æ±‚éƒ½ä½¿ç”¨æœ€æ–°å¯ç”¨æ•°æ®æ¸²æŸ“ã€‚ä½†å¤§å¤šæ•°é¡µé¢ç”±é™æ€å’ŒåŠ¨æ€éƒ¨åˆ†ç»„æˆï¼Œå¹¶éæ‰€æœ‰åŠ¨æ€æ•°æ®éƒ½éœ€è¦åœ¨æ¯æ¬¡è¯·æ±‚æ—¶ä»æºè·å–ã€‚</p>
<p>Cache Components å…è®¸ä½ æ ‡è®°æ•°æ®ï¼Œç”šè‡³å°† UI çš„éƒ¨åˆ†æ ‡è®°ä¸ºå¯ç¼“å­˜ï¼Œè¿™ä¼šå°†å®ƒä»¬ä¸é¡µé¢çš„é™æ€éƒ¨åˆ†ä¸€èµ·åŒ…å«åœ¨é¢„æ¸²æŸ“é˜¶æ®µä¸­ã€‚</p>
<h3 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h3><p>å½“ç”¨æˆ·è®¿é—®è·¯ç”±æ—¶ï¼š</p>
<ol>
<li><strong>æœåŠ¡å™¨å‘é€é™æ€å¤–å£³</strong>ï¼šåŒ…å«ç¼“å­˜å†…å®¹ï¼Œç¡®ä¿å¿«é€Ÿåˆå§‹åŠ è½½</li>
<li><strong>åŠ¨æ€éƒ¨åˆ†æ˜¾ç¤º fallback</strong>ï¼šåŒ…è£¹åœ¨ <code>Suspense</code> è¾¹ç•Œä¸­çš„åŠ¨æ€éƒ¨åˆ†åœ¨å¤–å£³ä¸­æ˜¾ç¤º fallback UI</li>
<li><strong>åŠ¨æ€å†…å®¹æµå¼ä¼ è¾“</strong>ï¼šåªæœ‰åŠ¨æ€éƒ¨åˆ†æ¸²æŸ“ä»¥æ›¿æ¢å…¶ fallbackï¼Œå¹¶è¡Œæµå¼ä¼ è¾“</li>
<li><strong>ç¼“å­˜çš„åŠ¨æ€æ•°æ®åŒ…å«åœ¨å¤–å£³ä¸­</strong>ï¼šé€šè¿‡ <code>use cache</code> ç¼“å­˜çš„åŸæœ¬åŠ¨æ€çš„æ•°æ®å¯ä»¥åŒ…å«åœ¨åˆå§‹å¤–å£³ä¸­</li>
</ol>
<p><img src="https://h8dxkfmaphn8o0p3.public.blob.vercel-storage.com/learn/light/thinking-in-ppr.png" alt="PPR å·¥ä½œæµç¨‹ - next.jså®˜æ–¹å›¾ç‰‡"></p>
<blockquote>
<p><strong>å®˜æ–¹è§†é¢‘</strong>: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=MTcPrTIBkpA">Why PPR and how it works (10 åˆ†é’Ÿ)</a></p>
</blockquote>
<hr>
<h2 id="æ ¸å¿ƒå·¥ä½œåŸç†"><a href="#æ ¸å¿ƒå·¥ä½œåŸç†" class="headerlink" title="æ ¸å¿ƒå·¥ä½œåŸç†"></a>æ ¸å¿ƒå·¥ä½œåŸç†</h2><p>Cache Components æä¾›ä¸‰ä¸ªå…³é”®å·¥å…·æ¥æ§åˆ¶æ¸²æŸ“ï¼š</p>
<h3 id="1-Suspense-for-Runtime-Dataï¼ˆè¿è¡Œæ—¶æ•°æ®ï¼‰"><a href="#1-Suspense-for-Runtime-Dataï¼ˆè¿è¡Œæ—¶æ•°æ®ï¼‰" class="headerlink" title="1. Suspense for Runtime Dataï¼ˆè¿è¡Œæ—¶æ•°æ®ï¼‰"></a>1. Suspense for Runtime Dataï¼ˆè¿è¡Œæ—¶æ•°æ®ï¼‰</h3><p>æŸäº›æ•°æ®ä»…åœ¨å®é™…ç”¨æˆ·å‘å‡ºè¯·æ±‚æ—¶åœ¨è¿è¡Œæ—¶å¯ç”¨ã€‚</p>
<p><strong>è¿è¡Œæ—¶ API åŒ…æ‹¬</strong>ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/functions/cookies"><code>cookies()</code></a> - è®¿é—® Cookie</li>
<li><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/functions/headers"><code>headers()</code></a> - è®¿é—®è¯·æ±‚å¤´</li>
<li><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/file-conventions/page#searchparams-optional"><code>searchParams</code></a> - URL æŸ¥è¯¢å‚æ•°</li>
<li><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/file-conventions/page#params-optional"><code>params</code></a> - åŠ¨æ€è·¯ç”±å‚æ•°ï¼ˆé™¤éé€šè¿‡ <code>generateStaticParams</code> æä¾›ï¼‰</li>
</ul>
<p><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼šå°†ä½¿ç”¨è¿™äº› API çš„ç»„ä»¶åŒ…è£¹åœ¨ <code>Suspense</code> è¾¹ç•Œä¸­ï¼Œä»¥ä¾¿é¡µé¢çš„å…¶ä½™éƒ¨åˆ†å¯ä»¥é¢„æ¸²æŸ“ä¸ºé™æ€å¤–å£³ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; cookies &#125; <span class="keyword">from</span> <span class="string">&quot;next/headers&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* é™æ€éƒ¨åˆ† - ç«‹å³æ˜¾ç¤º */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">header</span>&gt;</span>My App<span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;/* åŠ¨æ€éƒ¨åˆ† - éœ€è¦ Suspense */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span>&gt;</span>Loading user...<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">UserInfo</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">UserInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> userId = (<span class="keyword">await</span> <span class="title function_">cookies</span>()).<span class="title function_">get</span>(<span class="string">&quot;userId&quot;</span>)?.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">const</span> user = <span class="keyword">await</span> db.<span class="property">users</span>.<span class="title function_">findUnique</span>(&#123; <span class="attr">where</span>: &#123; <span class="attr">id</span>: userId &#125; &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Welcome, &#123;user.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Suspense-for-Dynamic-Dataï¼ˆåŠ¨æ€æ•°æ®ï¼‰"><a href="#2-Suspense-for-Dynamic-Dataï¼ˆåŠ¨æ€æ•°æ®ï¼‰" class="headerlink" title="2. Suspense for Dynamic Dataï¼ˆåŠ¨æ€æ•°æ®ï¼‰"></a>2. Suspense for Dynamic Dataï¼ˆåŠ¨æ€æ•°æ®ï¼‰</h3><p>åŠ¨æ€æ•°æ®å¦‚ <code>fetch</code> è°ƒç”¨æˆ–æ•°æ®åº“æŸ¥è¯¢å¯èƒ½åœ¨è¯·æ±‚ä¹‹é—´å‘ç”Ÿå˜åŒ–ï¼Œä½†ä¸æ˜¯ç”¨æˆ·ç‰¹å®šçš„ã€‚</p>
<p><strong>åŠ¨æ€æ•°æ®æ¨¡å¼åŒ…æ‹¬</strong>ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/functions/fetch"><code>fetch()</code></a> è¯·æ±‚</li>
<li>æ•°æ®åº“æŸ¥è¯¢ï¼ˆ<code>db.query(...)</code>ï¼‰</li>
<li><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/functions/connection"><code>connection()</code></a> - å…ƒåŠ¨æ€ API</li>
</ul>
<p><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼šå°†ä½¿ç”¨è¿™äº›çš„ç»„ä»¶åŒ…è£¹åœ¨ <code>Suspense</code> è¾¹ç•Œä¸­ä»¥å¯ç”¨æµå¼ä¼ è¾“ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Products<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span>&gt;</span>Loading products...<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProductList</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">ProductList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> products = <span class="keyword">await</span> db.<span class="property">products</span>.<span class="title function_">findMany</span>();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;products.map((p) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;p.id&#125;</span>&gt;</span>&#123;p.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-Cached-Data-with-use-cacheï¼ˆç¼“å­˜æ•°æ®ï¼‰"><a href="#3-Cached-Data-with-use-cacheï¼ˆç¼“å­˜æ•°æ®ï¼‰" class="headerlink" title="3. Cached Data with use cacheï¼ˆç¼“å­˜æ•°æ®ï¼‰"></a>3. Cached Data with <code>use cache</code>ï¼ˆç¼“å­˜æ•°æ®ï¼‰</h3><p>å°† <code>use cache</code> æ·»åŠ åˆ°ä»»ä½• Server Component ä»¥ä½¿å…¶ç¼“å­˜å¹¶åŒ…å«åœ¨é¢„æ¸²æŸ“çš„å¤–å£³ä¸­ã€‚</p>
<p><strong>é™åˆ¶</strong>ï¼š</p>
<ul>
<li>âŒ ä¸èƒ½åœ¨ç¼“å­˜ç»„ä»¶å†…ä½¿ç”¨è¿è¡Œæ—¶ APIï¼ˆcookiesã€headers ç­‰ï¼‰</li>
<li>âœ… å¯ä»¥æ ‡è®°å·¥å…·å‡½æ•°ä¸º <code>use cache</code> å¹¶ä» Server Components è°ƒç”¨</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getProducts</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> db.<span class="title function_">query</span>(<span class="string">&quot;SELECT * FROM products&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä½¿ç”¨-Suspense-è¾¹ç•Œ"><a href="#ä½¿ç”¨-Suspense-è¾¹ç•Œ" class="headerlink" title="ä½¿ç”¨ Suspense è¾¹ç•Œ"></a>ä½¿ç”¨ Suspense è¾¹ç•Œ</h2><p>React <a target="_blank" rel="noopener" href="https://react.dev/reference/react/Suspense">Suspense</a> è¾¹ç•Œè®©ä½ å®šä¹‰å½“å®ƒåŒ…è£¹åŠ¨æ€æˆ–è¿è¡Œæ—¶æ•°æ®æ—¶ä½¿ç”¨ä»€ä¹ˆ fallback UIã€‚</p>
<h3 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>è¿™ä¼šè¢«é¢„æ¸²æŸ“<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">Skeleton</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">DynamicContent</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">DynamicContent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;http://api.cms.com/posts&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> &#123; posts &#125; = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;/* æ¸²æŸ“æ–‡ç«  */&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<ul>
<li>è¾¹ç•Œå¤–çš„å†…å®¹ï¼ˆåŒ…æ‹¬ fallback UIï¼‰è¢«é¢„æ¸²æŸ“ä¸ºé™æ€å¤–å£³</li>
<li>è¾¹ç•Œå†…çš„å†…å®¹åœ¨å‡†å¤‡å¥½æ—¶æµå¼ä¼ è¾“</li>
</ul>
<p>åœ¨æ„å»ºæ—¶ï¼ŒNext.js é¢„æ¸²æŸ“é™æ€å†…å®¹å’Œ <code>fallback</code> UIï¼Œè€ŒåŠ¨æ€å†…å®¹è¢«æ¨è¿Ÿåˆ°ç”¨æˆ·è¯·æ±‚è·¯ç”±æ—¶ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå°†ç»„ä»¶åŒ…è£¹åœ¨ <code>Suspense</code> ä¸­ä¸ä¼šä½¿å…¶åŠ¨æ€ï¼›ä½ çš„ API ä½¿ç”¨å†³å®šäº†è¿™ä¸€ç‚¹ã€‚<code>Suspense</code> ä½œä¸ºå°è£…åŠ¨æ€å†…å®¹å’Œå¯ç”¨æµå¼ä¼ è¾“çš„è¾¹ç•Œã€‚</p>
</blockquote>
<h3 id="ç¼ºå°‘-Suspense-è¾¹ç•Œæ—¶çš„é”™è¯¯"><a href="#ç¼ºå°‘-Suspense-è¾¹ç•Œæ—¶çš„é”™è¯¯" class="headerlink" title="ç¼ºå°‘ Suspense è¾¹ç•Œæ—¶çš„é”™è¯¯"></a>ç¼ºå°‘ Suspense è¾¹ç•Œæ—¶çš„é”™è¯¯</h3><p>Cache Components å¼ºåˆ¶è¦æ±‚åŠ¨æ€ä»£ç å¿…é¡»åŒ…è£¹åœ¨ <code>Suspense</code> è¾¹ç•Œä¸­ã€‚å¦‚æœå¿˜è®°ï¼Œä½ ä¼šçœ‹åˆ°é”™è¯¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Uncached data was accessed outside of &lt;Suspense&gt;</span><br><span class="line"></span><br><span class="line">This delays the entire page from rendering, resulting in a slow user</span><br><span class="line">experience. Next.js uses this error to ensure your app loads instantly</span><br><span class="line">on every navigation.</span><br><span class="line"></span><br><span class="line">To fix this, you can either:</span><br><span class="line">- Wrap the component in a &lt;Suspense&gt; boundary</span><br><span class="line">- Move the asynchronous await into a Cache Component(&quot;use cache&quot;)</span><br></pre></td></tr></table></figure>

<p><strong>ä¿®å¤æ–¹æ³•</strong>ï¼š</p>
<ol>
<li><strong>æ·»åŠ  Suspense è¾¹ç•Œ</strong>ï¼ˆæ¨èï¼‰</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">Loading</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">DynamicComponent</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>ä½¿ç”¨ <code>use cache</code></strong> ç¼“å­˜å·¥ä½œ</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">DynamicComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æµå¼ä¼ è¾“å·¥ä½œåŸç†"><a href="#æµå¼ä¼ è¾“å·¥ä½œåŸç†" class="headerlink" title="æµå¼ä¼ è¾“å·¥ä½œåŸç†"></a>æµå¼ä¼ è¾“å·¥ä½œåŸç†</h3><p>æµå¼ä¼ è¾“å°†è·¯ç”±åˆ†å‰²æˆå—ï¼Œå¹¶åœ¨å‡†å¤‡å¥½æ—¶é€æ­¥æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚è¿™å…è®¸ç”¨æˆ·åœ¨æ•´ä¸ªå†…å®¹å®Œæˆæ¸²æŸ“ä¹‹å‰ç«‹å³çœ‹åˆ°é¡µé¢çš„éƒ¨åˆ†å†…å®¹ã€‚</p>
<p><img src="https://h8dxkfmaphn8o0p3.public.blob.vercel-storage.com/docs/light/server-rendering-with-streaming.png" alt="æµå¼ä¼ è¾“ç¤ºæ„å›¾ - next.jså®˜æ–¹å›¾ç‰‡"></p>
<p>é€šè¿‡éƒ¨åˆ†é¢„æ¸²æŸ“ï¼Œåˆå§‹ UI å¯ä»¥ç«‹å³å‘é€åˆ°æµè§ˆå™¨ï¼Œè€ŒåŠ¨æ€éƒ¨åˆ†åˆ™åœ¨æ¸²æŸ“æ—¶æµå¼ä¼ è¾“ã€‚è¿™å‡å°‘äº† UI æ˜¾ç¤ºæ—¶é—´ï¼Œå¹¶å¯èƒ½å‡å°‘æ€»è¯·æ±‚æ—¶é—´ã€‚</p>
<p><img src="https://h8dxkfmaphn8o0p3.public.blob.vercel-storage.com/docs/light/sequential-parallel-data-fetching.png" alt="æµå¼ä¼ è¾“å¹¶è¡ŒåŒ– - next.jså®˜æ–¹å›¾ç‰‡"></p>
<p>ä¸ºäº†å‡å°‘ç½‘ç»œå¼€é”€ï¼Œå®Œæ•´å“åº”ï¼ˆåŒ…æ‹¬é™æ€ HTML å’Œæµå¼åŠ¨æ€éƒ¨åˆ†ï¼‰åœ¨<strong>å•ä¸ª HTTP è¯·æ±‚</strong>ä¸­å‘é€ã€‚è¿™é¿å…äº†é¢å¤–çš„å¾€è¿”ï¼Œå¹¶æé«˜äº†åˆå§‹åŠ è½½å’Œæ•´ä½“æ€§èƒ½ã€‚</p>
<hr>
<h2 id="ä½¿ç”¨-use-cache"><a href="#ä½¿ç”¨-use-cache" class="headerlink" title="ä½¿ç”¨ use cache"></a>ä½¿ç”¨ use cache</h2><p>è™½ç„¶ <code>Suspense</code> è¾¹ç•Œç®¡ç†åŠ¨æ€å†…å®¹ï¼Œä½† <a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/directives/use-cache"><code>use cache</code></a> æŒ‡ä»¤å¯ç”¨äºç¼“å­˜ä¸ç»å¸¸æ›´æ”¹çš„æ•°æ®æˆ–è®¡ç®—ã€‚</p>
<h3 id="åŸºæœ¬ç”¨æ³•-1"><a href="#åŸºæœ¬ç”¨æ³•-1" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h3><p>å°† <code>use cache</code> æ·»åŠ åˆ°é¡µé¢ã€ç»„ä»¶æˆ–å¼‚æ­¥å‡½æ•°ï¼Œå¹¶ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/functions/cacheLife"><code>cacheLife</code></a> å®šä¹‰ç”Ÿå‘½å‘¨æœŸï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; cacheLife &#125; <span class="keyword">from</span> <span class="string">&quot;next/cache&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">cacheLife</span>(<span class="string">&quot;hours&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;https://api.example.com/data&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;/* æ¸²æŸ“æ•°æ® */&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="cacheLife-é¢„å®šä¹‰é…ç½®"><a href="#cacheLife-é¢„å®šä¹‰é…ç½®" class="headerlink" title="cacheLife é¢„å®šä¹‰é…ç½®"></a>cacheLife é¢„å®šä¹‰é…ç½®</h3><table>
<thead>
<tr>
<th>Profile</th>
<th>Use Case</th>
<th>stale</th>
<th>revalidate</th>
<th>expire</th>
</tr>
</thead>
<tbody><tr>
<td><code>&#39;default&#39;</code></td>
<td>Standard content</td>
<td>5 minutes</td>
<td>15 minutes</td>
<td>1 year</td>
</tr>
<tr>
<td><code>&#39;seconds&#39;</code></td>
<td>Real-time data</td>
<td>30 seconds</td>
<td>1 second</td>
<td>1 minute</td>
</tr>
<tr>
<td><code>&#39;minutes&#39;</code></td>
<td>Frequently updated content</td>
<td>5 minutes</td>
<td>1 minute</td>
<td>1 hour</td>
</tr>
<tr>
<td><code>&#39;hours&#39;</code></td>
<td>Content updated multiple times per day</td>
<td>5 minutes</td>
<td>1 hour</td>
<td>1 day</td>
</tr>
<tr>
<td><code>&#39;days&#39;</code></td>
<td>Content updated daily</td>
<td>5 minutes</td>
<td>1 day</td>
<td>1 week</td>
</tr>
<tr>
<td><code>&#39;weeks&#39;</code></td>
<td>Content updated weekly</td>
<td>5 minutes</td>
<td>1 week</td>
<td>30 days</td>
</tr>
<tr>
<td><code>&#39;max&#39;</code></td>
<td>Stable content that rarely changes</td>
<td>5 minutes</td>
<td>30 days</td>
<td>1 year</td>
</tr>
</tbody></table>
<p>expire è¦å¤§äº staleï¼Œstale ä¸è¦å°äº 30sï¼ˆä¸ç„¶ç¼“å­˜æ²¡æ„ä¹‰ï¼‰ã€‚</p>
<p><strong>è‡ªå®šä¹‰é…ç½®</strong>ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; cacheLife &#125; <span class="keyword">from</span> <span class="string">&quot;next/cache&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">CustomCache</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">cacheLife</span>(&#123;</span><br><span class="line">    <span class="attr">stale</span>: <span class="number">60</span>, <span class="comment">// 60 ç§’å†…è§†ä¸ºæ–°é²œ</span></span><br><span class="line">    <span class="attr">revalidate</span>: <span class="number">300</span>, <span class="comment">// 300 ç§’ååå°é‡æ–°éªŒè¯</span></span><br><span class="line">    <span class="attr">expire</span>: <span class="number">3600</span>, <span class="comment">// 3600 ç§’åè¿‡æœŸ</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;https://api.example.com/data&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ„å»ºæ—¶ä¸è¿è¡Œæ—¶è¡Œä¸º"><a href="#æ„å»ºæ—¶ä¸è¿è¡Œæ—¶è¡Œä¸º" class="headerlink" title="æ„å»ºæ—¶ä¸è¿è¡Œæ—¶è¡Œä¸º"></a>æ„å»ºæ—¶ä¸è¿è¡Œæ—¶è¡Œä¸º</h3><h4 id="use-cache-at-build-timeï¼ˆæ„å»ºæ—¶ï¼‰"><a href="#use-cache-at-build-timeï¼ˆæ„å»ºæ—¶ï¼‰" class="headerlink" title="use cache at build timeï¼ˆæ„å»ºæ—¶ï¼‰"></a>use cache at build timeï¼ˆæ„å»ºæ—¶ï¼‰</h4><p>å½“åœ¨ layout æˆ– page é¡¶éƒ¨ä½¿ç”¨ <code>use cache</code> æ—¶ï¼Œè·¯ç”±æ®µä¼šè¢«é¢„æ¸²æŸ“ï¼Œå…è®¸ä¹‹åé‡æ–°éªŒè¯ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/products/page.tsx</span></span><br><span class="line"><span class="string">&quot;use cache&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">ProductsPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">cacheLife</span>(<span class="string">&quot;hours&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> products = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;https://api.example.com/products&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span></span><br><span class="line">    res.<span class="title function_">json</span>()</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;/* æ¸²æŸ“äº§å“ */&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>âœ… è·¯ç”±æ®µåœ¨æ„å»ºæ—¶é¢„æ¸²æŸ“</li>
<li>âœ… å¯ä»¥åç»­ revalidated</li>
<li>âŒ <strong>ä¸èƒ½ä¸è¿è¡Œæ—¶æ•°æ®ä¸€èµ·ä½¿ç”¨</strong>ï¼ˆcookiesã€headersï¼‰</li>
</ul>
<p><strong>é‡è¦é™åˆ¶</strong>ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;use cache&quot;</span>;</span><br><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šuse cache ä¸èƒ½è®¿é—®è¿è¡Œæ—¶æ•°æ®</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> userId = (<span class="keyword">await</span> <span class="title function_">cookies</span>()).<span class="title function_">get</span>(<span class="string">&quot;userId&quot;</span>)?.<span class="property">value</span>; <span class="comment">// è¿è¡Œæ—¶é”™è¯¯ï¼</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;userId&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœéœ€è¦ç¼“å­˜ä¾èµ– cookiesã€headers æˆ– search params çš„å†…å®¹ï¼Œè¯·ä½¿ç”¨ <code>&#39;use cache: private&#39;</code> ä»£æ›¿ã€‚</p>
</blockquote>
<h4 id="use-cache-at-runtimeï¼ˆè¿è¡Œæ—¶ï¼‰"><a href="#use-cache-at-runtimeï¼ˆè¿è¡Œæ—¶ï¼‰" class="headerlink" title="use cache at runtimeï¼ˆè¿è¡Œæ—¶ï¼‰"></a>use cache at runtimeï¼ˆè¿è¡Œæ—¶ï¼‰</h4><p>å½“åº”ç”¨è¿è¡Œæ—¶ï¼Œ<code>use cache</code> åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„è¡Œä¸ºï¼š</p>
<p><strong>æœåŠ¡å™¨ç«¯</strong>ï¼š</p>
<ul>
<li>å•ä¸ªç»„ä»¶æˆ–å‡½æ•°çš„ç¼“å­˜æ¡ç›®ä¼šç¼“å­˜åœ¨å†…å­˜ä¸­</li>
<li>å¤šä¸ªè¯·æ±‚å¯ä»¥å…±äº«è¿™äº›ç¼“å­˜æ¡ç›®</li>
</ul>
<p><strong>å®¢æˆ·ç«¯</strong>ï¼š</p>
<ul>
<li>ä»æœåŠ¡å™¨ç¼“å­˜è¿”å›çš„ä»»ä½•å†…å®¹ä¼šå­˜å‚¨åœ¨æµè§ˆå™¨å†…å­˜ä¸­</li>
<li>æŒç»­æ•´ä¸ªä¼šè¯æˆ–ç›´åˆ°é‡æ–°éªŒè¯</li>
<li>é¡µé¢åˆ·æ–°æˆ–å¯¼èˆªç¦»å¼€ä¼šæ¸…é™¤ç¼“å­˜</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡å™¨ç«¯ç¼“å­˜çš„å·¥å…·å‡½æ•°</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getCachedProducts</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">cacheLife</span>(<span class="string">&quot;hours&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> db.<span class="property">products</span>.<span class="title function_">findMany</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼šæŸ¥è¯¢æ•°æ®åº“ â†’ ç¼“å­˜åœ¨æœåŠ¡å™¨å†…å­˜</span></span><br><span class="line">  <span class="keyword">const</span> products = <span class="keyword">await</span> <span class="title function_">getCachedProducts</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åç»­è¯·æ±‚ï¼šç›´æ¥ä»æœåŠ¡å™¨å†…å­˜ç¼“å­˜è¿”å›</span></span><br><span class="line">  <span class="comment">// å®¢æˆ·ç«¯æ”¶åˆ°çš„æ•°æ®ä¹Ÿä¼šç¼“å­˜åœ¨æµè§ˆå™¨å†…å­˜ä¸­</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;/* æ¸²æŸ“äº§å“ */&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç¼“å­˜ç”Ÿå‘½å‘¨æœŸ</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">æ„å»ºæ—¶ï¼š</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ 1. é¢„æ¸²æŸ“è·¯ç”±æ®µ</span><br><span class="line">â”‚ 2. ç”Ÿæˆé™æ€ HTML</span><br><span class="line">â”‚ 3. ç¼“å­˜ç»“æœä¾›åç»­è¯·æ±‚ä½¿ç”¨</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"></span><br><span class="line">è¿è¡Œæ—¶ï¼ˆæœåŠ¡å™¨ï¼‰ï¼š</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ è¯·æ±‚ 1 â†’ æ‰§è¡Œå‡½æ•° â†’ ç¼“å­˜ç»“æœï¼ˆå†…å­˜ï¼‰</span><br><span class="line">â”‚ è¯·æ±‚ 2 â†’ å‘½ä¸­ç¼“å­˜ â†’ è¿”å›ç¼“å­˜ç»“æœ</span><br><span class="line">â”‚ è¯·æ±‚ 3 â†’ å‘½ä¸­ç¼“å­˜ â†’ è¿”å›ç¼“å­˜ç»“æœ</span><br><span class="line">â”‚ ...ç›´åˆ°é‡æ–°éªŒè¯æˆ–è¿‡æœŸ</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"></span><br><span class="line">è¿è¡Œæ—¶ï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼š</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ 1. æ¥æ”¶æœåŠ¡å™¨ç¼“å­˜çš„æ•°æ®</span><br><span class="line">â”‚ 2. å­˜å‚¨åœ¨æµè§ˆå™¨å†…å­˜</span><br><span class="line">â”‚ 3. å¯¼èˆªæ—¶å¤ç”¨ï¼ˆåŒä¸€ä¼šè¯ï¼‰</span><br><span class="line">â”‚ 4. sessionè¿‡æœŸæˆ–è€…revalidated â†’ æ¸…é™¤</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨é™åˆ¶"><a href="#ä½¿ç”¨é™åˆ¶" class="headerlink" title="ä½¿ç”¨é™åˆ¶"></a>ä½¿ç”¨é™åˆ¶</h3><h4 id="1-å‚æ•°å¿…é¡»å¯åºåˆ—åŒ–"><a href="#1-å‚æ•°å¿…é¡»å¯åºåˆ—åŒ–" class="headerlink" title="1. å‚æ•°å¿…é¡»å¯åºåˆ—åŒ–"></a>1. å‚æ•°å¿…é¡»å¯åºåˆ—åŒ–</h4><p>ä¸ Server Actions ç±»ä¼¼ï¼Œç¼“å­˜å‡½æ•°çš„å‚æ•°å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä¼ é€’åŸå§‹ç±»å‹ã€æ™®é€šå¯¹è±¡å’Œæ•°ç»„ï¼Œä½†ä¸èƒ½ä¼ é€’ç±»å®ä¾‹ã€å‡½æ•°æˆ–å…¶ä»–å¤æ‚ç±»å‹ã€‚</p>
<h4 id="2-å¯æ¥å—ä½†ä¸èƒ½å†…çœä¸å¯åºåˆ—åŒ–çš„å€¼"><a href="#2-å¯æ¥å—ä½†ä¸èƒ½å†…çœä¸å¯åºåˆ—åŒ–çš„å€¼" class="headerlink" title="2. å¯æ¥å—ä½†ä¸èƒ½å†…çœä¸å¯åºåˆ—åŒ–çš„å€¼"></a>2. å¯æ¥å—ä½†ä¸èƒ½å†…çœä¸å¯åºåˆ—åŒ–çš„å€¼</h4><p>ä½ å¯ä»¥æ¥å—ä¸å¯åºåˆ—åŒ–çš„å€¼ä½œä¸ºå‚æ•°ï¼Œåªè¦ä½ ä¸å†…çœå®ƒä»¬ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥è¿”å›å®ƒä»¬ã€‚è¿™å…è®¸åƒç¼“å­˜ç»„ä»¶æ¥å— Server æˆ– Client Components ä½œä¸º children çš„æ¨¡å¼ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ReactNode</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">CachedWrapper</span>(<span class="params">&#123; children &#125;: &#123; children: ReactNode &#125;</span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="comment">// ä¸è¦å†…çœ childrenï¼Œåªæ˜¯ä¼ é€’å®ƒ</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">header</span>&gt;</span>Cached Header<span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®ç‚¹</strong>ï¼šä¸å¯åºåˆ—åŒ–çš„å‚æ•°ï¼ˆå¦‚ JSXã€å‡½æ•°ï¼‰ä¸ä¼šæˆä¸ºç¼“å­˜é”®çš„ä¸€éƒ¨åˆ†ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getCached</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">id</span>: <span class="built_in">number</span>, <span class="comment">// âœ… å¯åºåˆ—åŒ– â†’ åŒ…å«åœ¨ç¼“å­˜é”®ä¸­</span></span></span><br><span class="line"><span class="params">  <span class="attr">children</span>: <span class="title class_">ReactNode</span>, <span class="comment">// âŒ ä¸å¯åºåˆ—åŒ– â†’ ä¸åŒ…å«åœ¨ç¼“å­˜é”®ä¸­</span></span></span><br><span class="line"><span class="params">  <span class="attr">callback</span>: () =&gt; <span class="built_in">void</span> <span class="comment">// âŒ ä¸å¯åºåˆ—åŒ– â†’ ä¸åŒ…å«åœ¨ç¼“å­˜é”®ä¸­</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123; id, <span class="attr">content</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›¸åŒ idï¼Œä¸åŒ children â†’ ç¼“å­˜å‘½ä¸­</span></span><br><span class="line"><span class="keyword">const</span> result1 = <span class="keyword">await</span> <span class="title function_">getCached</span>(<span class="number">1</span>, <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>A<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line"><span class="keyword">const</span> result2 = <span class="keyword">await</span> <span class="title function_">getCached</span>(<span class="number">1</span>, <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>B<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line"><span class="comment">// result1 å’Œ result2 æ¥è‡ªåŒä¸€ç¼“å­˜ï¼ˆå› ä¸º id ç›¸åŒï¼‰</span></span><br></pre></td></tr></table></figure>

<h4 id="3-é¿å…ä¼ é€’åŠ¨æ€è¾“å…¥"><a href="#3-é¿å…ä¼ é€’åŠ¨æ€è¾“å…¥" class="headerlink" title="3. é¿å…ä¼ é€’åŠ¨æ€è¾“å…¥"></a>3. é¿å…ä¼ é€’åŠ¨æ€è¾“å…¥</h4><p>é™¤éä½ é¿å…å†…çœå®ƒä»¬ï¼Œå¦åˆ™ä¸èƒ½å°†åŠ¨æ€æˆ–è¿è¡Œæ—¶æ•°æ®ä¼ é€’åˆ° <code>use cache</code> å‡½æ•°ä¸­ã€‚ä¼ é€’æ¥è‡ª <code>cookies()</code>ã€<code>headers()</code> æˆ–å…¶ä»–è¿è¡Œæ—¶ API çš„å€¼ä½œä¸ºå‚æ•°å°†å¯¼è‡´é”™è¯¯ï¼Œå› ä¸ºæ— æ³•åœ¨é¢„æ¸²æŸ“æ—¶ç¡®å®šç¼“å­˜é”®ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šä¼ é€’è¿è¡Œæ—¶æ•°æ®</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">BadExample</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> userId = (<span class="keyword">await</span> <span class="title function_">cookies</span>()).<span class="title function_">get</span>(<span class="string">&quot;userId&quot;</span>)?.<span class="property">value</span>; <span class="comment">// è¿è¡Œæ—¶é”™è¯¯ï¼</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;userId&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šä¸åœ¨ç¼“å­˜ä¸­ä½¿ç”¨è¿è¡Œæ—¶ API</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">GoodExample</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// æ—  &#x27;use cache&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> userId = (<span class="keyword">await</span> <span class="title function_">cookies</span>()).<span class="title function_">get</span>(<span class="string">&quot;userId&quot;</span>)?.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;userId&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ ‡è®°å’Œé‡æ–°éªŒè¯"><a href="#æ ‡è®°å’Œé‡æ–°éªŒè¯" class="headerlink" title="æ ‡è®°å’Œé‡æ–°éªŒè¯"></a>æ ‡è®°å’Œé‡æ–°éªŒè¯</h3><p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/functions/cacheTag"><code>cacheTag</code></a> æ ‡è®°ç¼“å­˜æ•°æ®ï¼Œå¹¶åœ¨çªå˜åä½¿ç”¨ <a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/functions/updateTag"><code>updateTag</code></a> æˆ– <a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/functions/revalidateTag"><code>revalidateTag</code></a> é‡æ–°éªŒè¯ã€‚</p>
<h4 id="ä½¿ç”¨-updateTagï¼ˆç«‹å³æ›´æ–°ï¼‰"><a href="#ä½¿ç”¨-updateTagï¼ˆç«‹å³æ›´æ–°ï¼‰" class="headerlink" title="ä½¿ç”¨ updateTagï¼ˆç«‹å³æ›´æ–°ï¼‰"></a>ä½¿ç”¨ updateTagï¼ˆç«‹å³æ›´æ–°ï¼‰</h4><p>å½“ä½ éœ€è¦åœ¨åŒä¸€è¯·æ±‚ä¸­è¿‡æœŸå¹¶ç«‹å³åˆ·æ–°ç¼“å­˜æ•°æ®æ—¶ä½¿ç”¨ <code>updateTag</code>ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;use server&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; cacheTag, updateTag &#125; <span class="keyword">from</span> <span class="string">&quot;next/cache&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getCart</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">cacheTag</span>(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line">  <span class="comment">// è·å–æ•°æ®</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">updateCart</span>(<span class="params"><span class="attr">itemId</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use server&quot;</span>;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨ itemId å†™å…¥æ•°æ®</span></span><br><span class="line">  <span class="comment">// æ›´æ–°ç”¨æˆ·è´­ç‰©è½¦</span></span><br><span class="line">  <span class="title function_">updateTag</span>(<span class="string">&quot;cart&quot;</span>); <span class="comment">// ç«‹å³ä½¿ç¼“å­˜å¤±æ•ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>âœ… éœ€è¦ç”¨æˆ·ç«‹å³çœ‹åˆ°æ›´æ–°ï¼ˆå¦‚è´­ç‰©è½¦ï¼‰</li>
<li>âœ… Read-your-own-writes æ¨¡å¼</li>
<li>âœ… Server Actions ä¸“ç”¨</li>
</ul>
<h4 id="ä½¿ç”¨-revalidateTagï¼ˆåå°é‡æ–°éªŒè¯ï¼‰"><a href="#ä½¿ç”¨-revalidateTagï¼ˆåå°é‡æ–°éªŒè¯ï¼‰" class="headerlink" title="ä½¿ç”¨ revalidateTagï¼ˆåå°é‡æ–°éªŒè¯ï¼‰"></a>ä½¿ç”¨ revalidateTagï¼ˆåå°é‡æ–°éªŒè¯ï¼‰</h4><p>å½“ä½ æƒ³è¦ä»…ä½¿æ­£ç¡®æ ‡è®°çš„ç¼“å­˜æ¡ç›®å¤±æ•ˆå¹¶é‡‡ç”¨ stale-while-revalidate è¡Œä¸ºæ—¶ä½¿ç”¨ <code>revalidateTag</code>ã€‚è¿™å¯¹äºå¯ä»¥å®¹å¿æœ€ç»ˆä¸€è‡´æ€§çš„é™æ€å†…å®¹æ˜¯ç†æƒ³çš„ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;use server&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; cacheTag, revalidateTag &#125; <span class="keyword">from</span> <span class="string">&quot;next/cache&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getPosts</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">cacheTag</span>(<span class="string">&quot;posts&quot;</span>);</span><br><span class="line">  <span class="comment">// è·å–æ•°æ®</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createPost</span>(<span class="params"><span class="attr">post</span>: <span class="title class_">FormData</span></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use server&quot;</span>;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨ FormData å†™å…¥æ•°æ®</span></span><br><span class="line">  <span class="title function_">revalidateTag</span>(<span class="string">&quot;posts&quot;</span>, <span class="string">&quot;max&quot;</span>); <span class="comment">// åå°é‡æ–°éªŒè¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>âœ… å¯ä»¥å®¹å¿çŸ­æš‚è¿‡æœŸæ•°æ®ï¼ˆå¦‚åšå®¢æ–‡ç« ã€CMS å†…å®¹ï¼‰</li>
<li>âœ… é¿å…â€æƒŠç¾¤æ•ˆåº”â€ï¼ˆå¤šä¸ªè¯·æ±‚åŒæ—¶è§¦å‘æ•°æ®é‡æ–°ç”Ÿæˆï¼‰</li>
<li>âœ… Server Actions + Route Handlers</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨ <code>&#39;max&#39;</code> é…ç½®</strong>ï¼š</p>
<p><code>revalidateTag(tag, &#39;max&#39;)</code> ä½¿ç”¨ <strong>Stale-While-Revalidate (SWR)</strong> ç­–ç•¥ï¼š</p>
<ol>
<li>è°ƒç”¨ <code>revalidateTag</code></li>
<li>ç¼“å­˜æ ‡è®°ä¸º â€œstaleâ€ï¼ˆè¿‡æœŸä½†ä»å¯ç”¨ï¼‰</li>
<li>ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼š<ul>
<li>âœ… ç«‹å³è¿”å›è¿‡æœŸç¼“å­˜ï¼ˆå¿«é€Ÿå“åº”ï¼‰</li>
<li>ğŸ”„ åŒæ—¶åå°è§¦å‘é‡æ–°éªŒè¯</li>
</ul>
</li>
<li>å†ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼š<ul>
<li>âœ… è¿”å›æ›´æ–°åçš„æ–°æ•°æ®</li>
</ul>
</li>
</ol>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>ç”¨æˆ·ä¸ä¼šé‡åˆ°â€ç­‰å¾…æ•°æ®é‡æ–°ç”Ÿæˆâ€çš„å»¶è¿Ÿ</li>
<li>é¿å…é«˜æµé‡æ—¶çš„å¹¶å‘æ•°æ®åº“æŸ¥è¯¢</li>
<li>å¹³æ»‘çš„æ•°æ®æ›´æ–°è¿‡æ¸¡</li>
</ul>
<hr>
<h2 id="å¯ç”¨-Cache-Components"><a href="#å¯ç”¨-Cache-Components" class="headerlink" title="å¯ç”¨ Cache Components"></a>å¯ç”¨ Cache Components</h2><p>åœ¨ <code>next.config.ts</code> ä¸­æ·»åŠ  <a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/config/next-config-js/cacheComponents"><code>cacheComponents</code></a> é€‰é¡¹ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// next.config.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">NextConfig</span> &#125; <span class="keyword">from</span> <span class="string">&quot;next&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">nextConfig</span>: <span class="title class_">NextConfig</span> = &#123;</span><br><span class="line">  <span class="attr">cacheComponents</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> nextConfig;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// next.config.js</span></span><br><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;next&#x27;).NextConfig</span>&#125; */</span></span><br><span class="line"><span class="keyword">const</span> nextConfig = &#123;</span><br><span class="line">  <span class="attr">cacheComponents</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = nextConfig;</span><br></pre></td></tr></table></figure>

<h3 id="Navigation-with-Cache-Components"><a href="#Navigation-with-Cache-Components" class="headerlink" title="Navigation with Cache Components"></a>Navigation with Cache Components</h3><p>å½“å¯ç”¨ <a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/config/next-config-js/cacheComponents"><code>cacheComponents</code></a> æ ‡å¿—æ—¶ï¼ŒNext.js ä½¿ç”¨ React çš„ <a target="_blank" rel="noopener" href="https://react.dev/reference/react/Activity"><code>&lt;Activity&gt;</code></a> ç»„ä»¶åœ¨å®¢æˆ·ç«¯å¯¼èˆªæœŸé—´ä¿ç•™ç»„ä»¶çŠ¶æ€ã€‚</p>
<p>å·¥ä½œæ–¹å¼ï¼š</p>
<ul>
<li><strong>çŠ¶æ€ä¿ç•™</strong>ï¼šå¯¼èˆªç¦»å¼€æ—¶ä¸å¸è½½å‰ä¸€ä¸ªè·¯ç”±ï¼Œè€Œæ˜¯è®¾ç½® Activity æ¨¡å¼ä¸º <a target="_blank" rel="noopener" href="https://react.dev/reference/react/Activity#activity"><code>&quot;hidden&quot;</code></a></li>
<li><strong>å¯¼èˆªå›é€€</strong>ï¼šå¯¼èˆªå›æ¥æ—¶ï¼Œå‰ä¸€ä¸ªè·¯ç”±åŠå…¶çŠ¶æ€å®Œæ•´ä¿ç•™</li>
<li><strong>æ•ˆæœæ¸…ç†</strong>ï¼šè·¯ç”±éšè—æ—¶æ¸…ç†æ•ˆæœï¼Œå†æ¬¡å¯è§æ—¶é‡æ–°åˆ›å»º</li>
</ul>
<p><strong>å¥½å¤„</strong>ï¼šé€šè¿‡åœ¨ç”¨æˆ·å‰åå¯¼èˆªæ—¶ç»´æŠ¤ UI çŠ¶æ€ï¼ˆè¡¨å•è¾“å…¥ã€å±•å¼€çš„éƒ¨åˆ†ï¼‰æ¥æ”¹å–„å¯¼èˆªä½“éªŒã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šNext.js ä½¿ç”¨å¯å‘å¼æ–¹æ³•ä¿æŒå‡ ä¸ªæœ€è¿‘è®¿é—®çš„è·¯ç”±ä¸º <a target="_blank" rel="noopener" href="https://react.dev/reference/react/Activity#activity"><code>&quot;hidden&quot;</code></a>ï¼Œè€Œè¾ƒæ—§çš„è·¯ç”±ä» DOM ä¸­ç§»é™¤ä»¥é˜²æ­¢è¿‡åº¦å¢é•¿ã€‚</p>
</blockquote>
<hr>
<h2 id="ä»æ—§ç‰ˆæœ¬è¿ç§»"><a href="#ä»æ—§ç‰ˆæœ¬è¿ç§»" class="headerlink" title="ä»æ—§ç‰ˆæœ¬è¿ç§»"></a>ä»æ—§ç‰ˆæœ¬è¿ç§»</h2><p>å¯ç”¨ Cache Components åï¼Œå‡ ä¸ª Route Segment Config é€‰é¡¹ä¸å†éœ€è¦æˆ–ä¸å—æ”¯æŒã€‚ä»¥ä¸‹æ˜¯å˜åŒ–å’Œè¿ç§»æ–¹æ³•ï¼š</p>
<h3 id="1-dynamic-force-dynamic"><a href="#1-dynamic-force-dynamic" class="headerlink" title="1. dynamic = &quot;force-dynamic&quot;"></a>1. <code>dynamic = &quot;force-dynamic&quot;</code></h3><p><strong>ä¸å†éœ€è¦</strong>ã€‚å¯ç”¨ Cache Components åï¼Œæ‰€æœ‰é¡µé¢é»˜è®¤æ˜¯åŠ¨æ€çš„ï¼Œå› æ­¤æ­¤é…ç½®ä¸å¿…è¦ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ä¹‹å‰ - ä¸å†éœ€è¦</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> dynamic = <span class="string">&quot;force-dynamic&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… ä¹‹å - ç›´æ¥åˆ é™¤ï¼Œé¡µé¢é»˜è®¤æ˜¯åŠ¨æ€çš„</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-dynamic-force-static"><a href="#2-dynamic-force-static" class="headerlink" title="2. dynamic = &quot;force-static&quot;"></a>2. <code>dynamic = &quot;force-static&quot;</code></h3><p><strong>ç”¨ <code>use cache</code> æ›¿ä»£</strong>ã€‚ä½ å¿…é¡»ä¸ºå…³è”è·¯ç”±çš„æ¯ä¸ª Layout å’Œ Page æ·»åŠ  <code>use cache</code>ã€‚</p>
<blockquote>
<p>16.0.1 ç‰ˆæœ¬å®é™…æµ‹è¯•å‘ç°<code>cache-control</code>å˜æˆ<code>no-store</code>äº†ï¼Œå…³é—­ cacheComponent ä¼šå‡ºç° s-maxage å’Œ swrï¼Œè¡Œä¸ºä¸ä¸€è‡´ã€‚</p>
</blockquote>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼š<code>force-static</code> ä¹‹å‰å…è®¸ä½¿ç”¨è¿è¡Œæ—¶ API å¦‚ <code>cookies()</code>ï¼Œä½†ç°åœ¨ä¸å†æ”¯æŒã€‚å¦‚æœä½ æ·»åŠ  <code>use cache</code> å¹¶çœ‹åˆ°ä¸è¿è¡Œæ—¶æ•°æ®ç›¸å…³çš„é”™è¯¯ï¼Œä½ å¿…é¡»ç§»é™¤è¿è¡Œæ—¶ API çš„ä½¿ç”¨ã€‚</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ä¹‹å‰</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> dynamic = <span class="string">&quot;force-static&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;https://api.example.com/data&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… ä¹‹å - ä½¿ç”¨ &#x27;use cache&#x27; æ›¿ä»£</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;https://api.example.com/data&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-revalidate"><a href="#3-revalidate" class="headerlink" title="3. revalidate"></a>3. <code>revalidate</code></h3><p><strong>ç”¨ <code>cacheLife</code> æ›¿ä»£</strong>ã€‚ä½¿ç”¨ <code>cacheLife</code> å‡½æ•°å®šä¹‰ç¼“å­˜æŒç»­æ—¶é—´ï¼Œè€Œä¸æ˜¯è·¯ç”±æ®µé…ç½®ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ä¹‹å‰</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> revalidate = <span class="number">3600</span>; <span class="comment">// 1 å°æ—¶</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… ä¹‹å - ä½¿ç”¨ cacheLife</span></span><br><span class="line"><span class="keyword">import</span> &#123; cacheLife &#125; <span class="keyword">from</span> <span class="string">&quot;next/cache&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">cacheLife</span>(<span class="string">&quot;hours&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-fetchCache"><a href="#4-fetchCache" class="headerlink" title="4. fetchCache"></a>4. <code>fetchCache</code></h3><p><strong>ä¸å†éœ€è¦</strong>ã€‚ä½¿ç”¨ <code>use cache</code> æ—¶ï¼Œç¼“å­˜èŒƒå›´å†…çš„æ‰€æœ‰æ•°æ®è·å–éƒ½ä¼šè‡ªåŠ¨ç¼“å­˜ï¼Œä½¿ <code>fetchCache</code> ä¸å¿…è¦ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ä¹‹å‰</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fetchCache = <span class="string">&quot;force-cache&quot;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… ä¹‹å - ä½¿ç”¨ &#x27;use cache&#x27; æ§åˆ¶ç¼“å­˜è¡Œä¸º</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="comment">// è¿™é‡Œçš„æ‰€æœ‰ fetch éƒ½è¢«ç¼“å­˜</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-runtime-edge"><a href="#5-runtime-edge" class="headerlink" title="5. runtime = &#39;edge&#39;"></a>5. <code>runtime = &#39;edge&#39;</code></h3><p><strong>ä¸æ”¯æŒ</strong>ã€‚Cache Components éœ€è¦ Node.js è¿è¡Œæ—¶ï¼Œä½¿ç”¨ <a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/edge">Edge Runtime</a> ä¼šæŠ›å‡ºé”™è¯¯ã€‚</p>
<hr>
<h2 id="å®æˆ˜ç¤ºä¾‹"><a href="#å®æˆ˜ç¤ºä¾‹" class="headerlink" title="å®æˆ˜ç¤ºä¾‹"></a>å®æˆ˜ç¤ºä¾‹</h2><h3 id="ç¤ºä¾‹-1-åŠ¨æ€-API-ä½¿ç”¨"><a href="#ç¤ºä¾‹-1-åŠ¨æ€-API-ä½¿ç”¨" class="headerlink" title="ç¤ºä¾‹ 1: åŠ¨æ€ API ä½¿ç”¨"></a>ç¤ºä¾‹ 1: åŠ¨æ€ API ä½¿ç”¨</h3><p>å½“è®¿é—®è¿è¡Œæ—¶ API å¦‚ <code>cookies()</code> æ—¶ï¼ŒNext.js åªä¼šé¢„æ¸²æŸ“æ­¤ç»„ä»¶ä¸Šæ–¹çš„ fallback UIã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/user.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; cookies &#125; <span class="keyword">from</span> <span class="string">&quot;next/headers&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">User</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> session = (<span class="keyword">await</span> <span class="title function_">cookies</span>()).<span class="title function_">get</span>(<span class="string">&quot;session&quot;</span>)?.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>User: &#123;session&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>é¡µé¢ç»„ä»¶</strong>ï¼ˆéœ€è¦ Suspenseï¼‰ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/page.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">User</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./user&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>è¿™ä¼šè¢«é¢„æ¸²æŸ“<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span>&gt;</span>Loading user...<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">User</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¤ºä¾‹-2-ä¼ é€’åŠ¨æ€-Props"><a href="#ç¤ºä¾‹-2-ä¼ é€’åŠ¨æ€-Props" class="headerlink" title="ç¤ºä¾‹ 2: ä¼ é€’åŠ¨æ€ Props"></a>ç¤ºä¾‹ 2: ä¼ é€’åŠ¨æ€ Props</h3><p>ç»„ä»¶åªæœ‰åœ¨è®¿é—®å€¼æ—¶æ‰é€‰æ‹©åŠ¨æ€æ¸²æŸ“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ ä» <code>&lt;Page /&gt;</code> ç»„ä»¶è¯»å– <code>searchParams</code>ï¼Œä½ å¯ä»¥å°†æ­¤å€¼ä½œä¸º prop è½¬å‘åˆ°å¦ä¸€ä¸ªç»„ä»¶ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/page.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Table</span>, <span class="title class_">TableSkeleton</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./table&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  searchParams,</span></span><br><span class="line"><span class="params">&#125;: &#123;</span></span><br><span class="line"><span class="params">  searchParams: <span class="built_in">Promise</span>&lt;&#123; sort: <span class="built_in">string</span> &#125;&gt;;</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>è¿™ä¼šè¢«é¢„æ¸²æŸ“<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">TableSkeleton</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Table</span> <span class="attr">searchParams</span>=<span class="string">&#123;searchParams.then((search)</span> =&gt;</span> search.sort)&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Table ç»„ä»¶</strong>ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/table.tsx</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Table</span>(<span class="params">&#123; sortPromise &#125;: &#123; sortPromise: <span class="built_in">Promise</span>&lt;<span class="built_in">string</span>&gt; &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> sort = (<span class="keyword">await</span> sortPromise) === <span class="string">&quot;true&quot;</span>;</span><br><span class="line">  <span class="comment">// è®¿é—®å€¼ä½¿ç»„ä»¶åŠ¨æ€ï¼Œä½†é¡µé¢çš„å…¶ä½™éƒ¨åˆ†ä¼šè¢«é¢„æ¸²æŸ“</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;/* æ¸²æŸ“è¡¨æ ¼ */&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¤ºä¾‹-3-Route-Handlers-with-Cache-Components"><a href="#ç¤ºä¾‹-3-Route-Handlers-with-Cache-Components" class="headerlink" title="ç¤ºä¾‹ 3: Route Handlers with Cache Components"></a>ç¤ºä¾‹ 3: Route Handlers with Cache Components</h3><p><code>GET</code> Route Handlers éµå¾ªä¸åº”ç”¨ä¸­æ­£å¸¸ UI è·¯ç”±ç›¸åŒçš„æ¨¡å‹ã€‚å®ƒä»¬é»˜è®¤æ˜¯åŠ¨æ€çš„ï¼Œå¯ä»¥åœ¨ç¡®å®šæ€§æ—¶é¢„æ¸²æŸ“ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>use cache</code> åœ¨ç¼“å­˜å“åº”ä¸­åŒ…å«æ›´å¤šåŠ¨æ€æ•°æ®ã€‚</p>
<p><strong>åŠ¨æ€ç¤ºä¾‹</strong>ï¼ˆæ¯æ¬¡è¯·æ±‚è¿”å›ä¸åŒæ•°å­—ï¼‰ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/api/random-number/route.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">GET</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Response</span>.<span class="title function_">json</span>(&#123;</span><br><span class="line">    <span class="attr">randomNumber</span>: <span class="title class_">Math</span>.<span class="title function_">random</span>(),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>é™æ€ç¤ºä¾‹</strong>ï¼ˆåœ¨æ„å»ºæ—¶é¢„æ¸²æŸ“ï¼‰ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/api/project-info/route.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">GET</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Response</span>.<span class="title function_">json</span>(&#123;</span><br><span class="line">    <span class="attr">projectName</span>: <span class="string">&quot;Next.js&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç¼“å­˜åŠ¨æ€æ•°æ®ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/api/products/route.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; cacheLife &#125; <span class="keyword">from</span> <span class="string">&quot;next/cache&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">GET</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> products = <span class="keyword">await</span> <span class="title function_">getProducts</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Response</span>.<span class="title function_">json</span>(products);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getProducts</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">cacheLife</span>(<span class="string">&quot;hours&quot;</span>); <span class="comment">// æœ€å¤šæ¯å°æ—¶æŸ¥è¯¢ä¸€æ¬¡æ•°æ®åº“</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> db.<span class="title function_">query</span>(<span class="string">&quot;SELECT * FROM products&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li><code>use cache</code> ä¸èƒ½ç›´æ¥åœ¨ Route Handler ä¸»ä½“ä¸­ä½¿ç”¨ï¼›æå–åˆ°è¾…åŠ©å‡½æ•°</li>
<li>ç¼“å­˜å“åº”æ ¹æ® <code>cacheLife</code> åœ¨æ–°è¯·æ±‚åˆ°è¾¾æ—¶é‡æ–°éªŒè¯</li>
<li>ä½¿ç”¨è¿è¡Œæ—¶ API å¦‚ <code>cookies()</code> æˆ– <code>headers()</code>ï¼Œæˆ–è°ƒç”¨ <code>connection()</code>ï¼Œå§‹ç»ˆæ¨è¿Ÿåˆ°è¯·æ±‚æ—¶ï¼ˆæ— é¢„æ¸²æŸ“ï¼‰</li>
</ul>
</blockquote>
<h3 id="ç¤ºä¾‹-4-å®Œæ•´ç”µå•†é¡µé¢"><a href="#ç¤ºä¾‹-4-å®Œæ•´ç”µå•†é¡µé¢" class="headerlink" title="ç¤ºä¾‹ 4: å®Œæ•´ç”µå•†é¡µé¢"></a>ç¤ºä¾‹ 4: å®Œæ•´ç”µå•†é¡µé¢</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/products/[id]/page.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; cacheLife, cacheTag &#125; <span class="keyword">from</span> <span class="string">&quot;next/cache&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; cookies &#125; <span class="keyword">from</span> <span class="string">&quot;next/headers&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">ProductPage</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  params,</span></span><br><span class="line"><span class="params">&#125;: &#123;</span></span><br><span class="line"><span class="params">  params: <span class="built_in">Promise</span>&lt;&#123; id: <span class="built_in">string</span> &#125;&gt;;</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* é™æ€å¯¼èˆª - ç«‹å³æ˜¾ç¤º */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/products&quot;</span>&gt;</span>Products<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;/* äº§å“ä¿¡æ¯ - å…¬å…±ç¼“å­˜ï¼Œ1 å°æ—¶ */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">ProductSkeleton</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProductInfo</span> <span class="attr">params</span>=<span class="string">&#123;params&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;/* ç”¨æˆ·è´­ç‰©è½¦ - åŠ¨æ€ï¼Œæ— ç¼“å­˜ */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">CartSkeleton</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">UserCart</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;/* æ¨èå•†å“ - å…¬å…±ç¼“å­˜ï¼Œ1 å¤© */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">RecommendationsSkeleton</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Recommendations</span> <span class="attr">params</span>=<span class="string">&#123;params&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº§å“ä¿¡æ¯ - ç¼“å­˜ 1 å°æ—¶</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">ProductInfo</span>(<span class="params">&#123; params &#125;: &#123; params: <span class="built_in">Promise</span>&lt;&#123; id: <span class="built_in">string</span> &#125;&gt; &#125;</span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">cacheLife</span>(<span class="string">&quot;hours&quot;</span>);</span><br><span class="line">  <span class="title function_">cacheTag</span>(<span class="string">&quot;products&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = <span class="keyword">await</span> params;</span><br><span class="line">  <span class="keyword">const</span> product = <span class="keyword">await</span> db.<span class="property">products</span>.<span class="title function_">findUnique</span>(&#123; <span class="attr">where</span>: &#123; id &#125; &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;product.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;product.description&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Price: $&#123;product.price&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æˆ·è´­ç‰©è½¦ - åŠ¨æ€ï¼Œæ¯æ¬¡è¯·æ±‚è·å–</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">UserCart</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> userId = (<span class="keyword">await</span> <span class="title function_">cookies</span>()).<span class="title function_">get</span>(<span class="string">&quot;userId&quot;</span>)?.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">const</span> cart = <span class="keyword">await</span> db.<span class="property">carts</span>.<span class="title function_">findUnique</span>(&#123;</span><br><span class="line">    <span class="attr">where</span>: &#123; userId &#125;,</span><br><span class="line">    <span class="attr">include</span>: &#123; <span class="attr">items</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Your Cart<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;cart.items.length&#125; items<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨èå•†å“ - ç¼“å­˜ 1 å¤©</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Recommendations</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  params,</span></span><br><span class="line"><span class="params">&#125;: &#123;</span></span><br><span class="line"><span class="params">  params: <span class="built_in">Promise</span>&lt;&#123; id: <span class="built_in">string</span> &#125;&gt;;</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">cacheLife</span>(<span class="string">&quot;days&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = <span class="keyword">await</span> params;</span><br><span class="line">  <span class="keyword">const</span> recommendations = <span class="keyword">await</span> <span class="title function_">getRecommendations</span>(id);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>You might also like<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;recommendations.map((r) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;r.id&#125;</span>&gt;</span>&#123;r.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><h3 id="1-æ ¹æ®æ•°æ®ç‰¹æ€§é€‰æ‹©ç­–ç•¥"><a href="#1-æ ¹æ®æ•°æ®ç‰¹æ€§é€‰æ‹©ç­–ç•¥" class="headerlink" title="1. æ ¹æ®æ•°æ®ç‰¹æ€§é€‰æ‹©ç­–ç•¥"></a>1. æ ¹æ®æ•°æ®ç‰¹æ€§é€‰æ‹©ç­–ç•¥</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… å…¬å…±ã€å˜åŒ–ä¸é¢‘ç¹çš„æ•°æ® â†’ use cache</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getCategories</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">cacheLife</span>(<span class="string">&quot;days&quot;</span>);</span><br><span class="line">  <span class="title function_">cacheTag</span>(<span class="string">&quot;categories&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> db.<span class="property">categories</span>.<span class="title function_">findMany</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ç”¨æˆ·ç‰¹å®šæ•°æ® â†’ åŠ¨æ€æ¸²æŸ“ï¼ˆæ— ç¼“å­˜ï¼‰</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getUserProfile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> userId = (<span class="keyword">await</span> <span class="title function_">cookies</span>()).<span class="title function_">get</span>(<span class="string">&quot;userId&quot;</span>)?.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> db.<span class="property">users</span>.<span class="title function_">findUnique</span>(&#123; <span class="attr">where</span>: &#123; <span class="attr">id</span>: userId &#125; &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… å®æ—¶æ•°æ® â†’ åŠ¨æ€æ¸²æŸ“ + connection()</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getLiveData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">connection</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;https://api.example.com/live&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-åˆç†ä½¿ç”¨-Suspense-åµŒå¥—"><a href="#2-åˆç†ä½¿ç”¨-Suspense-åµŒå¥—" class="headerlink" title="2. åˆç†ä½¿ç”¨ Suspense åµŒå¥—"></a>2. åˆç†ä½¿ç”¨ Suspense åµŒå¥—</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* å¤–å±‚ï¼šé¡µé¢çº§ Suspense */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">PageSkeleton</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">PageContent</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">PageContent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">StaticHeader</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;/* å†…å±‚ï¼šç»„ä»¶çº§ Suspenseï¼Œç»†ç²’åº¦æ§åˆ¶ */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">UserSkeleton</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">UserInfo</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">ProductsSkeleton</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProductList</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-ç¼“å­˜ç²’åº¦ç­–ç•¥"><a href="#3-ç¼“å­˜ç²’åº¦ç­–ç•¥" class="headerlink" title="3. ç¼“å­˜ç²’åº¦ç­–ç•¥"></a>3. ç¼“å­˜ç²’åº¦ç­–ç•¥</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… å¥½ï¼šç»†ç²’åº¦ç¼“å­˜</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">ProductCard</span>(<span class="params">&#123; id &#125;: &#123; id: <span class="built_in">string</span> &#125;</span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">cacheLife</span>(<span class="string">&quot;hours&quot;</span>);</span><br><span class="line">  <span class="title function_">cacheTag</span>(<span class="string">&quot;products&quot;</span>, <span class="string">`product-<span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> product = <span class="keyword">await</span> db.<span class="property">products</span>.<span class="title function_">findUnique</span>(&#123; <span class="attr">where</span>: &#123; id &#125; &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;product.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">ProductList</span>(<span class="params">&#123; ids &#125;: &#123; ids: <span class="built_in">string</span>[] &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;ids.map((id) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProductCard</span> <span class="attr">key</span>=<span class="string">&#123;id&#125;</span> <span class="attr">id</span>=<span class="string">&#123;id&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ å·®ï¼šç²—ç²’åº¦ç¼“å­˜ï¼ˆä¸çµæ´»ï¼‰</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">ProductList</span>(<span class="params">&#123; ids &#125;: &#123; ids: <span class="built_in">string</span>[] &#125;</span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>; <span class="comment">// æ•´ä¸ªåˆ—è¡¨ä½œä¸ºä¸€ä¸ªç¼“å­˜</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> products = <span class="keyword">await</span> db.<span class="property">products</span>.<span class="title function_">findMany</span>(&#123;</span><br><span class="line">    <span class="attr">where</span>: &#123; <span class="attr">id</span>: &#123; <span class="attr">in</span>: ids &#125; &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;products.map((p) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;p.id&#125;</span>&gt;</span>&#123;p.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸ºä»€ä¹ˆç»†ç²’åº¦æ›´å¥½</strong>ï¼š</p>
<ul>
<li>å•ä¸ªäº§å“æ›´æ–°æ—¶ï¼Œåªéœ€è¦ä½¿ä¸€ä¸ªç¼“å­˜å¤±æ•ˆ</li>
<li>ä¸åŒäº§å“å¯ä»¥æœ‰ä¸åŒçš„ç¼“å­˜ç­–ç•¥</li>
<li>æ›´å®¹æ˜“è°ƒè¯•å’Œç»´æŠ¤</li>
</ul>
<h3 id="4-å¤šçº§ç¼“å­˜æ ‡ç­¾"><a href="#4-å¤šçº§ç¼“å­˜æ ‡ç­¾" class="headerlink" title="4. å¤šçº§ç¼“å­˜æ ‡ç­¾"></a>4. å¤šçº§ç¼“å­˜æ ‡ç­¾</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">ProductDetails</span>(<span class="params">&#123; id &#125;: &#123; id: <span class="built_in">string</span> &#125;</span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">cacheLife</span>(<span class="string">&quot;hours&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨å¤šä¸ªæ ‡ç­¾ä¾¿äºä¸åŒçº§åˆ«çš„å¤±æ•ˆ</span></span><br><span class="line">  <span class="title function_">cacheTag</span>(</span><br><span class="line">    <span class="string">&quot;products&quot;</span>, <span class="comment">// æ‰€æœ‰äº§å“</span></span><br><span class="line">    <span class="string">`product-<span class="subst">$&#123;id&#125;</span>`</span>, <span class="comment">// ç‰¹å®šäº§å“</span></span><br><span class="line">    <span class="string">`category-electronics`</span> <span class="comment">// äº§å“ç±»åˆ«</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> product = <span class="keyword">await</span> db.<span class="property">products</span>.<span class="title function_">findUnique</span>(&#123; <span class="attr">where</span>: &#123; id &#125; &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;product.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤±æ•ˆç­–ç•¥ï¼š</span></span><br><span class="line"><span class="comment">// revalidateTag(`product-$&#123;id&#125;`, &#x27;max&#x27;)      // ä»…å¤±æ•ˆç‰¹å®šäº§å“</span></span><br><span class="line"><span class="comment">// revalidateTag(&#x27;category-electronics&#x27;, &#x27;max&#x27;) // å¤±æ•ˆæ•´ä¸ªç±»åˆ«</span></span><br><span class="line"><span class="comment">// revalidateTag(&#x27;products&#x27;, &#x27;max&#x27;)            // å¤±æ•ˆæ‰€æœ‰äº§å“</span></span><br></pre></td></tr></table></figure>

<h3 id="5-generateStaticParams-æœ€ä½³å®è·µ"><a href="#5-generateStaticParams-æœ€ä½³å®è·µ" class="headerlink" title="5. generateStaticParams æœ€ä½³å®è·µ"></a>5. generateStaticParams æœ€ä½³å®è·µ</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æ¨èï¼šé¢„ç”Ÿæˆçƒ­é—¨å†…å®¹ï¼Œå…¶ä½™æŒ‰éœ€ç”Ÿæˆ</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">generateStaticParams</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// åªé¢„ç”Ÿæˆå‰ 20 ä¸ªçƒ­é—¨äº§å“</span></span><br><span class="line">  <span class="keyword">const</span> topProducts = <span class="keyword">await</span> db.<span class="property">products</span></span><br><span class="line">    .<span class="title function_">orderBy</span>(<span class="string">&quot;views&quot;</span>, <span class="string">&quot;desc&quot;</span>)</span><br><span class="line">    .<span class="title function_">limit</span>(<span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">select</span>(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> topProducts.<span class="title function_">map</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> (&#123; <span class="attr">id</span>: p.<span class="property">id</span> &#125;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">ProductPage</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  params,</span></span><br><span class="line"><span class="params">&#125;: &#123;</span></span><br><span class="line"><span class="params">  params: <span class="built_in">Promise</span>&lt;&#123; id: <span class="built_in">string</span> &#125;&gt;;</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">cacheLife</span>(<span class="string">&quot;hours&quot;</span>);</span><br><span class="line">  <span class="title function_">cacheTag</span>(<span class="string">&quot;products&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = <span class="keyword">await</span> params;</span><br><span class="line">  <span class="keyword">const</span> product = <span class="keyword">await</span> db.<span class="property">products</span>.<span class="title function_">findUnique</span>(&#123; <span class="attr">where</span>: &#123; id &#125; &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;product.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç­–ç•¥è¯´æ˜</strong>ï¼š</p>
<ul>
<li><strong>ä½åŸºæ•°å‚æ•°</strong>ï¼ˆå¦‚åˆ†ç±»ã€è¯­è¨€ï¼‰ï¼šé¢„ç”Ÿæˆæ‰€æœ‰å€¼</li>
<li><strong>é«˜åŸºæ•°å‚æ•°</strong>ï¼ˆå¦‚äº§å“ IDï¼‰ï¼šåªé¢„ç”Ÿæˆçƒ­é—¨å€¼</li>
<li><strong>æŒ‰éœ€ç”Ÿæˆ</strong> + <strong>ç¼“å­˜</strong> &#x3D; ISR æ•ˆæœ</li>
</ul>
<hr>
<h2 id="å’Œ-Next-intl-ç»“åˆ"><a href="#å’Œ-Next-intl-ç»“åˆ" class="headerlink" title="å’Œ Next-intl ç»“åˆ"></a>å’Œ Next-intl ç»“åˆ</h2><p>ç°åœ¨ä½¿ç”¨ next-intl å¯èƒ½ä¼šå¯¼è‡´æŠ¥å„ç§ç¼ºå°‘ Suspense è¾¹ç•Œçš„é”™ï¼Œè¿™ä¸ªçš„æ ¸å¿ƒæ˜¯åœ¨ä¸æŒ‡å®š locale çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>getTranslate</code>,<code>useTranslate</code>,<code>&lt;Link&gt;</code>(next-intl çš„ Link)ä¼šå»è¯»å– headerï¼ˆx-next-intl-localeï¼‰ï¼Œç›¸å½“äºè¿™ä¸ªåº“ä¼šè‡ªå·±å»ç”¨ dynamic apiã€‚</p>
<p>è¦è§£å†³å¾ˆç®€å•ï¼Œæ‹¿åˆ° locale ä¹‹åå¡åˆ°<code>setRequestLocale</code>é‡Œæˆ–è€…ç›´æ¥å¡åˆ°å„ä¸ªçš„ locale å‚æ•°é‡Œã€‚</p>
<p>è¿™ä¸ªå’Œè§£å†³ static æ¸²æŸ“ç±»ä¼¼ã€‚</p>
<p>å‚è€ƒï¼š<br><a target="_blank" rel="noopener" href="https://next-intl.dev/docs/routing/setup#add-setrequestlocale-to-all-relevant-layouts-and-pages">Add setRequestLocale to all relevant layouts and pages</a></p>
<h2 id="å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ"><a href="#å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ"></a>å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ</h2><h3 id="é”™è¯¯-1-ç¼ºå°‘-Suspense-è¾¹ç•Œ"><a href="#é”™è¯¯-1-ç¼ºå°‘-Suspense-è¾¹ç•Œ" class="headerlink" title="é”™è¯¯ 1: ç¼ºå°‘ Suspense è¾¹ç•Œ"></a>é”™è¯¯ 1: ç¼ºå°‘ Suspense è¾¹ç•Œ</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> userId = (<span class="keyword">await</span> <span class="title function_">cookies</span>()).<span class="title function_">get</span>(<span class="string">&quot;userId&quot;</span>)?.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;userId&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯ä¿¡æ¯ï¼š</span></span><br><span class="line"><span class="comment">// Uncached data was accessed outside of &lt;Suspense&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… è§£å†³æ–¹æ¡ˆ 1: æ·»åŠ  Suspense</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">Loading</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">UserContent</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">UserContent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> userId = (<span class="keyword">await</span> <span class="title function_">cookies</span>()).<span class="title function_">get</span>(<span class="string">&quot;userId&quot;</span>)?.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;userId&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… è§£å†³æ–¹æ¡ˆ 2: ä½¿ç”¨ use cacheï¼ˆå¦‚æœé€‚ç”¨ï¼‰</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="comment">// ä½†æ³¨æ„ï¼šä¸èƒ½åœ¨ use cache ä¸­ä½¿ç”¨ cookies()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é”™è¯¯-2-åœ¨-use-cache-ä¸­ä½¿ç”¨è¿è¡Œæ—¶-API"><a href="#é”™è¯¯-2-åœ¨-use-cache-ä¸­ä½¿ç”¨è¿è¡Œæ—¶-API" class="headerlink" title="é”™è¯¯ 2: åœ¨ use cache ä¸­ä½¿ç”¨è¿è¡Œæ—¶ API"></a>é”™è¯¯ 2: åœ¨ use cache ä¸­ä½¿ç”¨è¿è¡Œæ—¶ API</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> userId = (<span class="keyword">await</span> <span class="title function_">cookies</span>()).<span class="title function_">get</span>(<span class="string">&quot;userId&quot;</span>)?.<span class="property">value</span>; <span class="comment">// è¿è¡Œæ—¶é”™è¯¯ï¼</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;userId&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… è§£å†³æ–¹æ¡ˆï¼šç§»é™¤ use cacheï¼Œä½¿ç”¨ Suspense</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// æ—  &#x27;use cache&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> userId = (<span class="keyword">await</span> <span class="title function_">cookies</span>()).<span class="title function_">get</span>(<span class="string">&quot;userId&quot;</span>)?.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;userId&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">Loading</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Component</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é”™è¯¯-3-Route-Segment-Config-ä¸å…¼å®¹"><a href="#é”™è¯¯-3-Route-Segment-Config-ä¸å…¼å®¹" class="headerlink" title="é”™è¯¯ 3: Route Segment Config ä¸å…¼å®¹"></a>é”™è¯¯ 3: Route Segment Config ä¸å…¼å®¹</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> revalidate = <span class="number">60</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> dynamic = <span class="string">&quot;force-static&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯ä¿¡æ¯ï¼š</span></span><br><span class="line"><span class="comment">// Route segment config &quot;revalidate&quot; is not compatible with</span></span><br><span class="line"><span class="comment">// `nextConfig.cacheComponents`. Please remove it.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… è§£å†³æ–¹æ¡ˆ</span></span><br><span class="line"><span class="keyword">import</span> &#123; cacheLife &#125; <span class="keyword">from</span> <span class="string">&quot;next/cache&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">cacheLife</span>(&#123; <span class="attr">revalidate</span>: <span class="number">60</span> &#125;);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é”™è¯¯-4-æœª-await-params-searchParams"><a href="#é”™è¯¯-4-æœª-await-params-searchParams" class="headerlink" title="é”™è¯¯ 4: æœª await params&#x2F;searchParams"></a>é”™è¯¯ 4: æœª await params&#x2F;searchParams</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params">&#123; params &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> id = params.<span class="property">id</span>; <span class="comment">// ç±»å‹é”™è¯¯ï¼params æ˜¯ Promise</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… è§£å†³æ–¹æ¡ˆ</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  params,</span></span><br><span class="line"><span class="params">&#125;: &#123;</span></span><br><span class="line"><span class="params">  params: <span class="built_in">Promise</span>&lt;&#123; id: <span class="built_in">string</span> &#125;&gt;;</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = <span class="keyword">await</span> params; <span class="comment">// å¿…é¡» await</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Product: &#123;id&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é”™è¯¯-5-åœ¨-Route-Handler-ä¸»ä½“ä¸­ä½¿ç”¨-use-cache"><a href="#é”™è¯¯-5-åœ¨-Route-Handler-ä¸»ä½“ä¸­ä½¿ç”¨-use-cache" class="headerlink" title="é”™è¯¯ 5: åœ¨ Route Handler ä¸»ä½“ä¸­ä½¿ç”¨ use cache"></a>é”™è¯¯ 5: åœ¨ Route Handler ä¸»ä½“ä¸­ä½¿ç”¨ use cache</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">GET</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>; <span class="comment">// ä¸èƒ½ç›´æ¥åœ¨è¿™é‡Œä½¿ç”¨</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Response</span>.<span class="title function_">json</span>(&#123; <span class="attr">data</span>: <span class="string">&quot;...&quot;</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… è§£å†³æ–¹æ¡ˆï¼šæå–åˆ°è¾…åŠ©å‡½æ•°</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">cacheLife</span>(<span class="string">&quot;hours&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> db.<span class="title function_">query</span>(<span class="string">&quot;SELECT * FROM data&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">GET</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getData</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Response</span>.<span class="title function_">json</span>(data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é”™è¯¯-6-ä¼ é€’ä¸å¯åºåˆ—åŒ–çš„å‚æ•°åˆ°-use-cache"><a href="#é”™è¯¯-6-ä¼ é€’ä¸å¯åºåˆ—åŒ–çš„å‚æ•°åˆ°-use-cache" class="headerlink" title="é”™è¯¯ 6: ä¼ é€’ä¸å¯åºåˆ—åŒ–çš„å‚æ•°åˆ° use cache"></a>é”™è¯¯ 6: ä¼ é€’ä¸å¯åºåˆ—åŒ–çš„å‚æ•°åˆ° use cache</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">cachedFunction</span>(<span class="params"><span class="attr">callback</span>: () =&gt; <span class="built_in">void</span></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="title function_">callback</span>(); <span class="comment">// é”™è¯¯ï¼šå†…çœä¸å¯åºåˆ—åŒ–çš„å‚æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… è§£å†³æ–¹æ¡ˆ 1ï¼šä¸å†…çœï¼Œåªä¼ é€’</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">cachedWrapper</span>(<span class="params">&#123; children &#125;: &#123; children: ReactNode &#125;</span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>; <span class="comment">// åªä¼ é€’ï¼Œä¸æ£€æŸ¥</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… è§£å†³æ–¹æ¡ˆ 2ï¼šåªæ¥å—å¯åºåˆ—åŒ–å‚æ•°</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">cachedFunction</span>(<span class="params"><span class="attr">data</span>: &#123; id: <span class="built_in">number</span>; name: <span class="built_in">string</span> &#125;</span>) &#123;</span><br><span class="line">  <span class="string">&quot;use cache&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><h3 id="Q-Cache-Components-æ˜¯å¦å–ä»£-PPRï¼Ÿ"><a href="#Q-Cache-Components-æ˜¯å¦å–ä»£-PPRï¼Ÿ" class="headerlink" title="Q: Cache Components æ˜¯å¦å–ä»£ PPRï¼Ÿ"></a>Q: Cache Components æ˜¯å¦å–ä»£ PPRï¼Ÿ</h3><p><strong>A</strong>: ä¸ã€‚Cache Components <strong>å®ç°äº†</strong> PPR ä½œä¸ºç‰¹æ€§ã€‚æ—§çš„å®éªŒæ€§ PPR æ ‡å¿—å·²è¢«ç§»é™¤ï¼Œä½† PPR ä»ç„¶å­˜åœ¨ã€‚</p>
<ul>
<li><strong>PPR</strong> æä¾›é™æ€å¤–å£³å’Œæµå¼ä¼ è¾“åŸºç¡€è®¾æ–½</li>
<li><strong><code>use cache</code></strong> è®©ä½ åœ¨å¤–å£³ä¸­åŒ…å«ä¼˜åŒ–çš„åŠ¨æ€è¾“å‡º</li>
</ul>
<h3 id="Q-æˆ‘åº”è¯¥é¦–å…ˆç¼“å­˜ä»€ä¹ˆï¼Ÿ"><a href="#Q-æˆ‘åº”è¯¥é¦–å…ˆç¼“å­˜ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Q: æˆ‘åº”è¯¥é¦–å…ˆç¼“å­˜ä»€ä¹ˆï¼Ÿ"></a>Q: æˆ‘åº”è¯¥é¦–å…ˆç¼“å­˜ä»€ä¹ˆï¼Ÿ</h3><p><strong>A</strong>: ä½ ç¼“å­˜çš„å†…å®¹åº”è¯¥å–å†³äºä½ å¸Œæœ› UI åŠ è½½çŠ¶æ€æ˜¯ä»€ä¹ˆã€‚å¦‚æœæ•°æ®ä¸ä¾èµ–è¿è¡Œæ—¶æ•°æ®ï¼Œå¹¶ä¸”ä½ å¯ä»¥æ¥å—åœ¨ä¸€æ®µæ—¶é—´å†…ä¸ºå¤šä¸ªè¯·æ±‚æä¾›ç¼“å­˜å€¼ï¼Œè¯·ä½¿ç”¨ <code>use cache</code> å’Œ <code>cacheLife</code> æ¥æè¿°è¯¥è¡Œä¸ºã€‚</p>
<p>å¯¹äºå…·æœ‰æ›´æ–°æœºåˆ¶çš„å†…å®¹ç®¡ç†ç³»ç»Ÿï¼Œè€ƒè™‘ä½¿ç”¨å…·æœ‰è¾ƒé•¿ç¼“å­˜æŒç»­æ—¶é—´çš„æ ‡ç­¾ï¼Œå¹¶ä¾èµ– <code>revalidateTag</code> å°†é™æ€åˆå§‹ UI æ ‡è®°ä¸ºå‡†å¤‡é‡æ–°éªŒè¯ã€‚è¿™ç§æ¨¡å¼å…è®¸ä½ æä¾›å¿«é€Ÿã€ç¼“å­˜çš„å“åº”ï¼ŒåŒæ—¶åœ¨å†…å®¹å®é™…æ›´æ”¹æ—¶ä»ç„¶æ›´æ–°å†…å®¹ï¼Œè€Œä¸æ˜¯æå‰è¿‡æœŸç¼“å­˜ã€‚</p>
<h3 id="Q-å¦‚ä½•å¿«é€Ÿæ›´æ–°ç¼“å­˜å†…å®¹ï¼Ÿ"><a href="#Q-å¦‚ä½•å¿«é€Ÿæ›´æ–°ç¼“å­˜å†…å®¹ï¼Ÿ" class="headerlink" title="Q: å¦‚ä½•å¿«é€Ÿæ›´æ–°ç¼“å­˜å†…å®¹ï¼Ÿ"></a>Q: å¦‚ä½•å¿«é€Ÿæ›´æ–°ç¼“å­˜å†…å®¹ï¼Ÿ</h3><p><strong>A</strong>: ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/functions/cacheTag"><code>cacheTag</code></a> æ ‡è®°ä½ çš„ç¼“å­˜æ•°æ®ï¼Œç„¶åè§¦å‘ <a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/functions/updateTag"><code>updateTag</code></a> æˆ– <a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/functions/revalidateTag"><code>revalidateTag</code></a>ã€‚</p>
<p><strong>é€‰æ‹©æŒ‡å—</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>ä½¿ç”¨</th>
<th>è¡Œä¸º</th>
</tr>
</thead>
<tbody><tr>
<td>éœ€è¦ç«‹å³çœ‹åˆ°æ›´æ–°</td>
<td><code>updateTag</code></td>
<td>ç«‹å³è¿‡æœŸï¼ŒåŒä¸€è¯·æ±‚å†…åˆ·æ–°</td>
</tr>
<tr>
<td>å¯ä»¥å®¹å¿çŸ­æš‚è¿‡æœŸ</td>
<td><code>revalidateTag</code></td>
<td>Stale-while-revalidateï¼Œåå°æ›´æ–°</td>
</tr>
</tbody></table>
<h3 id="Q-ISR-è¿˜æ”¯æŒå—ï¼Ÿ"><a href="#Q-ISR-è¿˜æ”¯æŒå—ï¼Ÿ" class="headerlink" title="Q: ISR è¿˜æ”¯æŒå—ï¼Ÿ"></a>Q: ISR è¿˜æ”¯æŒå—ï¼Ÿ</h3><p><strong>A</strong>: æ˜¯çš„ï¼ŒISR åŠŸèƒ½ä»ç„¶å­˜åœ¨ï¼Œä½† API å·²æ›´æ”¹ï¼š</p>
<ul>
<li>âŒ <code>export const revalidate = 60</code></li>
<li>âœ… <code>cacheLife(&#123; revalidate: 60 &#125;)</code></li>
</ul>
<p>ä½¿ç”¨ <code>use cache</code> + <code>cacheLife</code> + <code>generateStaticParams</code> å¯ä»¥å®ç°å®Œæ•´çš„ ISR åŠŸèƒ½ã€‚</p>
<h3 id="Q-å¯ä»¥æ··ç”¨æ—§-API-å’Œæ–°-API-å—ï¼Ÿ"><a href="#Q-å¯ä»¥æ··ç”¨æ—§-API-å’Œæ–°-API-å—ï¼Ÿ" class="headerlink" title="Q: å¯ä»¥æ··ç”¨æ—§ API å’Œæ–° API å—ï¼Ÿ"></a>Q: å¯ä»¥æ··ç”¨æ—§ API å’Œæ–° API å—ï¼Ÿ</h3><p><strong>A</strong>: ä¸å¯ä»¥ã€‚å¯ç”¨ <code>cacheComponents: true</code> åï¼š</p>
<ul>
<li>âŒ ä¸èƒ½ä½¿ç”¨ <code>export const revalidate</code></li>
<li>âŒ ä¸èƒ½ä½¿ç”¨ <code>export const dynamic</code></li>
<li>âŒ ä¸èƒ½ä½¿ç”¨ <code>export const fetchCache</code></li>
<li>âœ… å¿…é¡»ä½¿ç”¨ <code>use cache</code> + <code>cacheLife</code></li>
</ul>
<h3 id="Q-Edge-Runtime-æ”¯æŒå—ï¼Ÿ"><a href="#Q-Edge-Runtime-æ”¯æŒå—ï¼Ÿ" class="headerlink" title="Q: Edge Runtime æ”¯æŒå—ï¼Ÿ"></a>Q: Edge Runtime æ”¯æŒå—ï¼Ÿ</h3><p><strong>A</strong>: ä¸æ”¯æŒã€‚Cache Components éœ€è¦ Node.js è¿è¡Œæ—¶ã€‚</p>
<hr>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><h3 id="å®˜æ–¹æ–‡æ¡£"><a href="#å®˜æ–¹æ–‡æ¡£" class="headerlink" title="å®˜æ–¹æ–‡æ¡£"></a>å®˜æ–¹æ–‡æ¡£</h3><ul>
<li><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/getting-started/cache-components">Cache Components</a> - Cache Components å®Œæ•´æŒ‡å—</li>
<li><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/directives/use-cache">use cache Directive</a> - use cache API å‚è€ƒ</li>
<li><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/functions/cacheLife">cacheLife Function</a> - ç¼“å­˜ç”Ÿå‘½å‘¨æœŸé…ç½®</li>
<li><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/functions/cacheTag">cacheTag Function</a> - ç¼“å­˜æ ‡ç­¾</li>
<li><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/functions/updateTag">updateTag Function</a> - ç«‹å³æ›´æ–°ç¼“å­˜</li>
<li><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/api-reference/functions/revalidateTag">revalidateTag Function</a> - åå°é‡æ–°éªŒè¯</li>
<li><a target="_blank" rel="noopener" href="https://nextjs.org/blog/next-16">Next.js 16 Release</a> - Next.js 16 å‘å¸ƒå…¬å‘Š</li>
<li><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/guides/upgrading/version-16">Upgrading to Next.js 16</a> - å‡çº§æŒ‡å—</li>
</ul>
<h3 id="å…³é”®-API-é€ŸæŸ¥"><a href="#å…³é”®-API-é€ŸæŸ¥" class="headerlink" title="å…³é”® API é€ŸæŸ¥"></a>å…³é”® API é€ŸæŸ¥</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼“å­˜æŒ‡ä»¤</span></span><br><span class="line"><span class="string">&quot;use cache&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼“å­˜é…ç½®</span></span><br><span class="line"><span class="keyword">import</span> &#123; cacheLife, cacheTag &#125; <span class="keyword">from</span> <span class="string">&quot;next/cache&quot;</span>;</span><br><span class="line"><span class="title function_">cacheLife</span>(<span class="string">&quot;hours&quot;</span>);</span><br><span class="line"><span class="title function_">cacheLife</span>(&#123; <span class="attr">stale</span>: <span class="number">60</span>, <span class="attr">revalidate</span>: <span class="number">300</span>, <span class="attr">expire</span>: <span class="number">3600</span> &#125;);</span><br><span class="line"><span class="title function_">cacheTag</span>(<span class="string">&quot;tag1&quot;</span>, <span class="string">&quot;tag2&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼“å­˜å¤±æ•ˆ</span></span><br><span class="line"><span class="keyword">import</span> &#123; updateTag, revalidateTag &#125; <span class="keyword">from</span> <span class="string">&quot;next/cache&quot;</span>;</span><br><span class="line"><span class="title function_">updateTag</span>(<span class="string">&quot;tag&quot;</span>); <span class="comment">// ç«‹å³å¤±æ•ˆï¼ˆServer Actionsï¼‰</span></span><br><span class="line"><span class="title function_">revalidateTag</span>(<span class="string">&quot;tag&quot;</span>, <span class="string">&quot;max&quot;</span>); <span class="comment">// åå°é‡æ–°éªŒè¯ï¼ˆServer Actions + Route Handlersï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿è¡Œæ—¶ API</span></span><br><span class="line"><span class="keyword">import</span> &#123; cookies, headers &#125; <span class="keyword">from</span> <span class="string">&quot;next/headers&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connection &#125; <span class="keyword">from</span> <span class="string">&quot;next/server&quot;</span>;</span><br><span class="line"><span class="keyword">await</span> <span class="title function_">cookies</span>();</span><br><span class="line"><span class="keyword">await</span> <span class="title function_">headers</span>();</span><br><span class="line"><span class="keyword">await</span> <span class="title function_">connection</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Suspense</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">Loading</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">DynamicComponent</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="è§†é¢‘èµ„æº"><a href="#è§†é¢‘èµ„æº" class="headerlink" title="è§†é¢‘èµ„æº"></a>è§†é¢‘èµ„æº</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=MTcPrTIBkpA">Why PPR and how it works (YouTube, 10 åˆ†é’Ÿ)</a></li>
</ul>
<hr>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><strong>Cache Components çš„æ ¸å¿ƒç†å¿µ</strong>ï¼š</p>
<ol>
<li><p><strong>Cache Components &#x3D; PPR + use cache</strong></p>
<ul>
<li>PPR æ˜¯åŸºç¡€ï¼ˆé™æ€å¤–å£³ + æµå¼ä¼ è¾“ï¼‰</li>
<li>use cache æ˜¯å¢å¼ºï¼ˆæ˜¾å¼ç¼“å­˜æ§åˆ¶ï¼‰</li>
</ul>
</li>
<li><p><strong>é»˜è®¤åŠ¨æ€ï¼Œé€‰æ‹©æ€§ç¼“å­˜</strong></p>
<ul>
<li>ä¸æ—§ç‰ˆæœ¬ç›¸åï¼Œç°åœ¨é»˜è®¤éƒ½æ˜¯åŠ¨æ€çš„</li>
<li>ä½ å†³å®šä»€ä¹ˆéœ€è¦ç¼“å­˜</li>
</ul>
</li>
<li><p><strong>ä¸‰ä¸ªå…³é”®å·¥å…·</strong></p>
<ul>
<li>Suspense for runtime dataï¼ˆè¿è¡Œæ—¶æ•°æ®ï¼‰</li>
<li>Suspense for dynamic dataï¼ˆåŠ¨æ€æ•°æ®ï¼‰</li>
<li>use cache for cached dataï¼ˆç¼“å­˜æ•°æ®ï¼‰</li>
</ul>
</li>
<li><p><strong>ä»æ—§ API è¿ç§»</strong></p>
<ul>
<li>ç§»é™¤æ‰€æœ‰ Route Segment Config</li>
<li>ä½¿ç”¨ <code>use cache</code> + <code>cacheLife</code> æ›¿ä»£</li>
<li>params&#x2F;searchParams ç°åœ¨æ˜¯ Promise(ä½ ä» Next.js 15 æ¥çš„è¿™ç‚¹å°±é—®é¢˜ä¸å¤§)</li>
</ul>
</li>
<li><p><strong>æœ€ä½³å®è·µ</strong></p>
<ul>
<li>æ ¹æ®æ•°æ®ç‰¹æ€§é€‰æ‹©ç­–ç•¥</li>
<li>ç»†ç²’åº¦ç¼“å­˜ä¼˜äºç²—ç²’åº¦</li>
<li>åˆç†ä½¿ç”¨ Suspense åµŒå¥—</li>
<li>å¤šçº§ç¼“å­˜æ ‡ç­¾ä¾¿äºå¤±æ•ˆç®¡ç†</li>
</ul>
</li>
</ol>
<p>Cache Components è®©ç¼“å­˜è¡Œä¸ºæ›´æ¸…æ™°ã€æ›´å¯æ§ï¼Œæ˜¯æ„å»ºé«˜æ€§èƒ½ Next.js åº”ç”¨çš„å¼ºå¤§å·¥å…·ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://bingowith.me/2025/11/01/nextjs-16-cache-components-complete-guide/" data-id="cmiivw96k002fl4vahkpt4nu2" data-title="Next.js 16 Cache Components å®Œå…¨æŒ‡å—" class="article-share-link"><span class="fa fa-share">åˆ†äº«</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cache-Components/" rel="tag">Cache Components</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Next-js/" rel="tag">Next.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Next-js-16/" rel="tag">Next.js 16</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web-Development/" rel="tag">Web Development</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2025/11/16/nextjs-docker-deploy-pitfalls/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">å‰ä¸€ç¯‡</strong>
      <div class="article-nav-title">
        
          è‡ªè¡Œéƒ¨ç½² Next.js Docker çš„æŒ‘æˆ˜ï¼šè‡ƒè‚¿ã€å¹³å°ç»‘å®šä¸éšè—çš„â€œå‘â€
        
      </div>
    </a>
  
  
    <a href="/2025/09/29/mysql-docker-mysqldump-backup-script/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">åä¸€ç¯‡</strong>
      <div class="article-nav-title">åœ¨å®¹å™¨ä¸­è¿è¡Œçš„mysqlæ•°æ®åº“å®šæ—¶å¤‡ä»½è„šæœ¬</div>
    </a>
  
</nav>

  
</article>


</section>
        
      </div>
      <footer id="footer">
  
    <aside id="sidebar" class="outer">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">åˆ†ç±»</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AI/">AI</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AI/%E6%95%99%E7%A8%8B/">æ•™ç¨‹</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æ ‡ç­¾</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ASP-NET/" rel="tag">ASP.NET</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CDN/" rel="tag">CDN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSR/" rel="tag">CSR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cache-Components/" rel="tag">Cache Components</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ComfyUI/" rel="tag">ComfyUI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GPT/" rel="tag">GPT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GPU/" rel="tag">GPU</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/H2/" rel="tag">H2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JOOQ/" rel="tag">JOOQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Next-js/" rel="tag">Next.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Next-js-16/" rel="tag">Next.js 16</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OS/" rel="tag">OS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RSC/" rel="tag">RSC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPA/" rel="tag">SPA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSE/" rel="tag">SSE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web-Development/" rel="tag">Web Development</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Z-Image/" rel="tag">Z-Image</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auth-js/" rel="tag">auth.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aws/" rel="tag">aws</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure/" rel="tag">azure</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blazor/" rel="tag">blazor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/claude/" rel="tag">claude</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloudflare/" rel="tag">cloudflare</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker-compose/" rel="tag">docker compose</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dotnet/" rel="tag">dotnet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/drizzle/" rel="tag">drizzle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/expo-router/" rel="tag">expo router</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/filerobot-image-editor/" rel="tag">filerobot-image-editor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/" rel="tag">life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/llm/" rel="tag">llm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maui/" rel="tag">maui</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysqldump/" rel="tag">mysqldump</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nextjs/" rel="tag">nextjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openai/" rel="tag">openai</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/playwright/" rel="tag">playwright</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-native/" rel="tag">react native</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/remix/" rel="tag">remix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/route53/" rel="tag">route53</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rust/" rel="tag">rust</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shopify/" rel="tag">shopify</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shopify-CLI/" rel="tag">shopify CLI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-boot/" rel="tag">spring boot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/timestamp/" rel="tag">timestamp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/timezone/" rel="tag">timezone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/troubleshooting/" rel="tag">troubleshooting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BD%8E%E6%98%BE%E5%AD%98/" rel="tag">ä½æ˜¾å­˜</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BF%BB%E8%AF%91/" rel="tag">ç¿»è¯‘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%87%8F%E5%8C%96/" rel="tag">é‡åŒ–</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æ ‡ç­¾äº‘</h3>
    <div class="widget tagcloud">
      <a href="/tags/ASP-NET/" style="font-size: 10px;">ASP.NET</a> <a href="/tags/C/" style="font-size: 10px;">C#</a> <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/CSR/" style="font-size: 10px;">CSR</a> <a href="/tags/Cache-Components/" style="font-size: 10px;">Cache Components</a> <a href="/tags/ComfyUI/" style="font-size: 10px;">ComfyUI</a> <a href="/tags/GPT/" style="font-size: 10px;">GPT</a> <a href="/tags/GPU/" style="font-size: 10px;">GPU</a> <a href="/tags/H2/" style="font-size: 10px;">H2</a> <a href="/tags/JOOQ/" style="font-size: 10px;">JOOQ</a> <a href="/tags/MySQL/" style="font-size: 14px;">MySQL</a> <a href="/tags/Next-js/" style="font-size: 12px;">Next.js</a> <a href="/tags/Next-js-16/" style="font-size: 10px;">Next.js 16</a> <a href="/tags/OS/" style="font-size: 10px;">OS</a> <a href="/tags/RSC/" style="font-size: 10px;">RSC</a> <a href="/tags/React/" style="font-size: 10px;">React</a> <a href="/tags/SPA/" style="font-size: 10px;">SPA</a> <a href="/tags/SSE/" style="font-size: 10px;">SSE</a> <a href="/tags/Web-Development/" style="font-size: 10px;">Web Development</a> <a href="/tags/Z-Image/" style="font-size: 10px;">Z-Image</a> <a href="/tags/auth-js/" style="font-size: 10px;">auth.js</a> <a href="/tags/aws/" style="font-size: 12px;">aws</a> <a href="/tags/azure/" style="font-size: 12px;">azure</a> <a href="/tags/blazor/" style="font-size: 10px;">blazor</a> <a href="/tags/claude/" style="font-size: 10px;">claude</a> <a href="/tags/cloudflare/" style="font-size: 10px;">cloudflare</a> <a href="/tags/docker/" style="font-size: 14px;">docker</a> <a href="/tags/docker-compose/" style="font-size: 10px;">docker compose</a> <a href="/tags/dotnet/" style="font-size: 10px;">dotnet</a> <a href="/tags/drizzle/" style="font-size: 12px;">drizzle</a> <a href="/tags/expo-router/" style="font-size: 10px;">expo router</a> <a href="/tags/filerobot-image-editor/" style="font-size: 10px;">filerobot-image-editor</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/javascript/" style="font-size: 12px;">javascript</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/life/" style="font-size: 12px;">life</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/llm/" style="font-size: 10px;">llm</a> <a href="/tags/maui/" style="font-size: 10px;">maui</a> <a href="/tags/mybatis/" style="font-size: 10px;">mybatis</a> <a href="/tags/mysql/" style="font-size: 14px;">mysql</a> <a href="/tags/mysqldump/" style="font-size: 10px;">mysqldump</a> <a href="/tags/nextjs/" style="font-size: 16px;">nextjs</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/nodejs/" style="font-size: 12px;">nodejs</a> <a href="/tags/openai/" style="font-size: 12px;">openai</a> <a href="/tags/playwright/" style="font-size: 10px;">playwright</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/react-native/" style="font-size: 10px;">react native</a> <a href="/tags/remix/" style="font-size: 10px;">remix</a> <a href="/tags/route53/" style="font-size: 10px;">route53</a> <a href="/tags/rust/" style="font-size: 18px;">rust</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/shopify/" style="font-size: 14px;">shopify</a> <a href="/tags/shopify-CLI/" style="font-size: 10px;">shopify CLI</a> <a href="/tags/spring-boot/" style="font-size: 12px;">spring boot</a> <a href="/tags/timestamp/" style="font-size: 10px;">timestamp</a> <a href="/tags/timezone/" style="font-size: 10px;">timezone</a> <a href="/tags/troubleshooting/" style="font-size: 10px;">troubleshooting</a> <a href="/tags/%E4%BD%8E%E6%98%BE%E5%AD%98/" style="font-size: 10px;">ä½æ˜¾å­˜</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" style="font-size: 16px;">ç¿»è¯‘</a> <a href="/tags/%E9%87%8F%E5%8C%96/" style="font-size: 10px;">é‡åŒ–</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">å½’æ¡£</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/11/">åä¸€æœˆ 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/09/">ä¹æœˆ 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">å…«æœˆ 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/07/">ä¸ƒæœˆ 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">å…­æœˆ 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">äº”æœˆ 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/03/">ä¸‰æœˆ 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">ä¸€æœˆ 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">åäºŒæœˆ 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">ä¹æœˆ 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">å…­æœˆ 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">ä¸‰æœˆ 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">äºŒæœˆ 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">ä¸€æœˆ 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">åäºŒæœˆ 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">åä¸€æœˆ 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">å…«æœˆ 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">äº”æœˆ 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">å››æœˆ 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">äºŒæœˆ 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">åä¸€æœˆ 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">åæœˆ 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">äº”æœˆ 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">å››æœˆ 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">ä¸‰æœˆ 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">äºŒæœˆ 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">ä¸€æœˆ 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">äº”æœˆ 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">åæœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">å…«æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">å…­æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">äº”æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">ä¸‰æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">äºŒæœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">ä¸€æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">åäºŒæœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">åä¸€æœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">åæœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">ä¹æœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">å…«æœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">ä¸ƒæœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">å…­æœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">äº”æœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">å››æœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">ä¸‰æœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">äºŒæœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">åäºŒæœˆ 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">åä¸€æœˆ 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">åæœˆ 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">ä¹æœˆ 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/11/28/z-image-turbo-low-vram-setup/">6GBæ˜¾å­˜è·‘Z-Image-Turboå®Œå…¨æŒ‡å—</a>
          </li>
        
          <li>
            <a href="/2025/11/16/nextjs-docker-deploy-pitfalls/">è‡ªè¡Œéƒ¨ç½² Next.js Docker çš„æŒ‘æˆ˜ï¼šè‡ƒè‚¿ã€å¹³å°ç»‘å®šä¸éšè—çš„â€œå‘â€</a>
          </li>
        
          <li>
            <a href="/2025/11/01/nextjs-16-cache-components-complete-guide/">Next.js 16 Cache Components å®Œå…¨æŒ‡å—</a>
          </li>
        
          <li>
            <a href="/2025/09/29/mysql-docker-mysqldump-backup-script/">åœ¨å®¹å™¨ä¸­è¿è¡Œçš„mysqlæ•°æ®åº“å®šæ—¶å¤‡ä»½è„šæœ¬</a>
          </li>
        
          <li>
            <a href="/2025/08/14/nodejs-mysql-timezone-problem/">timestampå­˜å–å·®å‡ å°æ—¶? mysql timestampçš„timezoneé—®é¢˜ä»¥åŠå¦‚ä½•åœ¨mysql2è®¾ç½®</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 abaabaqua<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>





<script src="/js/script.js"></script>





  </div>
<!-- hexo injector body_end start --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.30.0/tocbot.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.30.0/tocbot.min.js"></script>
  
    <script>
    document.addEventListener('DOMContentLoaded', function () {
      if (window.location.pathname === '/') {
        return;
      }
      // æ£€æŸ¥æ˜¯å¦å­˜åœ¨ .article-entry å…ƒç´ 
      const articleEntry = document.querySelector('.article-entry');
      if (!articleEntry) return; // å¦‚æœä¸å­˜åœ¨ï¼Œç›´æ¥é€€å‡º

      // åœ¨ .article-title åé¢æ’å…¥ä¸€ä¸ª divï¼Œclass ä¸º toc
      const articleTitle = document.querySelector('header.article-header');
      if (!articleTitle) {
        return;
      }

      const tocDiv = document.createElement('div');
      tocDiv.className = 'toc';
      articleTitle.insertAdjacentElement('afterend', tocDiv);
      // åˆå§‹åŒ– tocbot
      tocbot.init({
        tocSelector: '.toc', // å°†ç›®å½•æ’å…¥åˆ°åˆšåˆšåˆ›å»ºçš„ .toc ä¸­
        contentSelector: '.article-entry',
        headingSelector: 'h2, h3, h4',
        collapseDepth: 3,
        scrollSmooth: true,
        scrollSmoothDuration: 420,
      });
    });
    </script>
  
    <script>
    document.addEventListener('DOMContentLoaded', function () {
      // åˆ›å»ºå›åˆ°é¡¶éƒ¨æŒ‰é’®
      const backToTopButton = document.createElement('div');
      backToTopButton.id = 'back-to-top';
      backToTopButton.innerHTML = 'â†‘ TOP';
      document.body.appendChild(backToTopButton);

      // ç›‘å¬æ»šåŠ¨äº‹ä»¶
      window.addEventListener('scroll', function () {
        if (window.scrollY > 300) { // å½“æ»šåŠ¨è¶…è¿‡300pxæ—¶æ˜¾ç¤ºæŒ‰é’®
          backToTopButton.classList.add('show');
        } else {
          backToTopButton.classList.remove('show');
        }
      });

      // ç‚¹å‡»æŒ‰é’®å›åˆ°é¡¶éƒ¨
      backToTopButton.addEventListener('click', function () {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
    });
    </script>
  <!-- hexo injector body_end end --></body>
</html>